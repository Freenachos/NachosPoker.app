'use client';

import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';
import { motion } from 'framer-motion';
import { 
  ExternalLink, 
  TrendingUp, 
  BarChart3, 
  Target, 
  Zap, 
  AlertTriangle, 
  DollarSign, 
  Activity, 
  Play, 
  RefreshCw, 
  Database, 
  LineChart,
  ChevronDown,
  Trophy,
  Users,
  Clock,
  Percent,
  Calculator,
  GraduationCap
} from 'lucide-react';
import NachosPokerNavBar from '@/components/NachosPokerNavBar';

/**
 * BBJ Dashboard & Variance Calculator
 * 
 * Part of the Freenachos App Suite
 * Analyzes Bad Beat Jackpot odds, EV, and variance based on 178M+ hand sample
 */

// ============================================
// TYPE DEFINITIONS
// ============================================

interface BBJConstants {
  handsPerBBJ: number;
  showdownsPerBBJ: number;
  avgPlayersPerTable: number;
  showdownRate: number;
  bbPer100Fees: number;
  feesPerBBJ_bb: number;
  poolDivisor: number;
  breakevenPayout_bb: number;
  breakevenPool_usd: number;
  evDivisor: number;
  winnerSharePercent: number;
  loserSharePercent: number;
  tableSharePercent: number;
  stakeFundCoefficient: number;
}

interface EVResult {
  payoutBB: number;
  returnRatio: number;
  netBBper100: number;
  isProfitable: boolean;
  percentToBreakeven: number;
  poolNeeded: number;
  jackpotWinnerPayout: number;
  opponentPayout: number;
  tableSharePayout: number;
  totalPayoutAtStake: number;
  stakePoolSize: number;
}

interface StakeOption {
  label: string;
  value: string;
  bbValue: number;
  poolPercent: number;
}

interface VarianceResult {
  expectedBBJs: number;
  expectedProfit: number;
  stdDeviation: number;
  confidenceInterval95: [number, number];
  confidenceInterval99: [number, number];
  probabilityOfProfit: number;
  totalFeesPaid: number;
  expectedPayouts: number;
  worstCase1Percent: number;
  bestCase1Percent: number;
}

interface SimulationTrial {
  trialNumber: number;
  bbjsHit: number;
  jackpotWins: number;
  opponentWins: number;
  tableShares: number;
  totalPayout: number;
  feesPaid: number;
  netProfit: number;
  timeline: { hands: number; profit: number; }[];
}

interface SimulationResults {
  trials: SimulationTrial[];
  averageProfit: number;
  medianProfit: number;
  stdDev: number;
  minProfit: number;
  maxProfit: number;
  profitableTrials: number;
  totalTrials: number;
  handsPerTrial: number;
  bottom20BBper100: number;
  top20BBper100: number;
}

// ============================================
// CONSTANTS - 178.6M Hand Verified Sample (GG Poker NL100+)
// ============================================

const BBJ_CONSTANTS: BBJConstants = {
  handsPerBBJ: 91501,
  showdownsPerBBJ: 13788,
  avgPlayersPerTable: 5.80,
  showdownRate: 0.1507,
  bbPer100Fees: 1.8346,
  feesPerBBJ_bb: 1679,
  poolDivisor: 325.87,
  breakevenPayout_bb: 1679,
  breakevenPool_usd: 2276000,
  evDivisor: 325.87,
  winnerSharePercent: 10,
  loserSharePercent: 3,
  tableSharePercent: 0.8,
  stakeFundCoefficient: 0.026658, // Stake Fund = Pool × BB × this coefficient
};

const STAKE_POOL_PERCENTAGES: Record<string, number> = {
  '10/20': 51.42,
  '5/10': 25.71,
  '2/5': 12.86,
  '1/2': 5.14,
  '0.50/1': 2.57,
  '0.25/0.50': 1.29,
  '0.10/0.25': 0.64,
  '0.05/0.10': 0.26,
  '0.02/0.05': 0.13,
  '0.01/0.02': 0.05,
};

const STAKE_OPTIONS: StakeOption[] = [
  { label: '$10/$20', value: '10/20', bbValue: 20, poolPercent: 51.42 },
  { label: '$5/$10', value: '5/10', bbValue: 10, poolPercent: 25.71 },
  { label: '$2/$5', value: '2/5', bbValue: 5, poolPercent: 12.86 },
  { label: '$1/$2', value: '1/2', bbValue: 2, poolPercent: 5.14 },
  { label: '$0.50/$1', value: '0.50/1', bbValue: 1, poolPercent: 2.57 },
  { label: '$0.25/$0.50', value: '0.25/0.50', bbValue: 0.50, poolPercent: 1.29 },
  { label: '$0.10/$0.25', value: '0.10/0.25', bbValue: 0.25, poolPercent: 0.64 },
  { label: '$0.05/$0.10', value: '0.05/0.10', bbValue: 0.10, poolPercent: 0.26 },
  { label: '$0.02/$0.05', value: '0.02/0.05', bbValue: 0.05, poolPercent: 0.13 },
  { label: '$0.01/$0.02', value: '0.01/0.02', bbValue: 0.02, poolPercent: 0.05 },
];

const PROBABILITY_DATA = {
  bbjPerHand: 1 / 91501,
  bbjPerShowdown: 1 / 13788,
  showdownRate: 0.1507,
  avgPlayers: 5.80,
  totalHandsAnalyzed: 178609881,
  regularHands: 144677485,
  rushCashHands: 33932396,
  totalShowdowns: 26913615,
  totalBBJsFound: 1952,
  duplicatesSkipped: 969330,
  totalFeesUSD: 47898236.39,
  totalFeesBB: 18993014.69,
  handsToSeeOneBBJ: 91501,
  handsToWinJackpot: Math.round(91501 * 5.80),
  handsToBeOpponent: Math.round(91501 * 5.80),
  handsToGetTableShare: Math.round(91501 * 5.80 / (5.80 - 2)),
  triggerHand: 'AAATT or better',
  returnAt8000bb: 0.8222,
  returnAt8500bb: 0.8736,
  returnAt9000bb: 0.9250,
  returnAt9500bb: 0.9764,
  returnAt10000bb: 1.0277,
};

// BBJ Interval Data - 50K hand cohorts showing BBJ distribution across 178M+ hands
// Each entry: [interval_number, bbj_count]
const BBJ_INTERVALS_RAW: [number, number][] = [
[1,2],[2,0],[3,1],[4,0],[5,0],[6,2],[7,0],[8,1],[9,0],[10,0],[11,1],[12,0],[13,0],[14,0],[15,0],[16,1],[17,0],[18,2],[19,0],[20,2],[21,0],[22,1],[23,1],[24,0],[25,0],[26,0],[27,0],[28,1],[29,0],[30,0],[31,0],[32,0],[33,1],[34,0],[35,0],[36,0],[37,0],[38,0],[39,0],[40,0],[41,0],[42,0],[43,0],[44,0],[45,1],[46,0],[47,0],[48,1],[49,0],[50,0],[51,0],[52,0],[53,1],[54,0],[55,0],[56,0],[57,0],[58,1],[59,0],[60,1],[61,0],[62,2],[63,1],[64,0],[65,1],[66,0],[67,2],[68,0],[69,0],[70,0],[71,0],[72,0],[73,0],[74,0],[75,0],[76,0],[77,0],[78,0],[79,0],[80,0],[81,0],[82,1],[83,0],[84,1],[85,0],[86,2],[87,0],[88,1],[89,1],[90,0],[91,0],[92,0],[93,0],[94,1],[95,0],[96,0],[97,1],[98,0],[99,1],[100,1],[101,0],[102,0],[103,1],[104,0],[105,0],[106,0],[107,0],[108,0],[109,0],[110,1],[111,1],[112,0],[113,0],[114,1],[115,1],[116,1],[117,1],[118,3],[119,0],[120,0],[121,0],[122,2],[123,4],[124,0],[125,0],[126,0],[127,0],[128,0],[129,0],[130,0],[131,1],[132,1],[133,0],[134,0],[135,0],[136,0],[137,2],[138,0],[139,0],[140,0],[141,0],[142,0],[143,1],[144,2],[145,0],[146,0],[147,0],[148,0],[149,0],[150,0],[151,0],[152,0],[153,0],[154,1],[155,1],[156,0],[157,0],[158,1],[159,1],[160,0],[161,0],[162,1],[163,3],[164,0],[165,0],[166,0],[167,1],[168,0],[169,1],[170,0],[171,0],[172,0],[173,1],[174,0],[175,1],[176,0],[177,0],[178,1],[179,0],[180,2],[181,0],[182,2],[183,1],[184,0],[185,1],[186,0],[187,0],[188,0],[189,1],[190,0],[191,1],[192,0],[193,0],[194,1],[195,0],[196,0],[197,0],[198,0],[199,1],[200,0],[201,1],[202,0],[203,0],[204,1],[205,2],[206,1],[207,0],[208,0],[209,0],[210,0],[211,0],[212,0],[213,0],[214,1],[215,1],[216,0],[217,1],[218,1],[219,0],[220,0],[221,1],[222,1],[223,0],[224,0],[225,0],[226,1],[227,2],[228,0],[229,0],[230,0],[231,1],[232,0],[233,0],[234,0],[235,0],[236,0],[237,0],[238,0],[239,0],[240,0],[241,1],[242,0],[243,0],[244,0],[245,1],[246,0],[247,2],[248,1],[249,0],[250,0],[251,0],[252,1],[253,0],[254,0],[255,0],[256,2],[257,2],[258,0],[259,1],[260,1],[261,0],[262,0],[263,0],[264,0],[265,2],[266,1],[267,0],[268,2],[269,0],[270,2],[271,0],[272,2],[273,0],[274,2],[275,2],[276,1],[277,0],[278,0],[279,1],[280,1],[281,2],[282,0],[283,0],[284,0],[285,0],[286,2],[287,1],[288,0],[289,0],[290,0],[291,0],[292,1],[293,0],[294,1],[295,1],[296,0],[297,0],[298,2],[299,0],[300,0],[301,0],[302,1],[303,0],[304,0],[305,0],[306,0],[307,0],[308,2],[309,0],[310,1],[311,0],[312,1],[313,1],[314,0],[315,0],[316,0],[317,0],[318,0],[319,1],[320,0],[321,0],[322,0],[323,0],[324,1],[325,0],[326,0],[327,2],[328,0],[329,0],[330,0],[331,0],[332,0],[333,0],[334,2],[335,0],[336,0],[337,2],[338,2],[339,0],[340,0],[341,0],[342,0],[343,0],[344,1],[345,0],[346,0],[347,0],[348,0],[349,1],[350,1],[351,1],[352,0],[353,1],[354,0],[355,2],[356,0],[357,0],[358,0],[359,0],[360,0],[361,0],[362,0],[363,0],[364,0],[365,0],[366,1],[367,0],[368,0],[369,1],[370,1],[371,1],[372,0],[373,2],[374,0],[375,2],[376,0],[377,2],[378,1],[379,1],[380,0],[381,0],[382,1],[383,2],[384,0],[385,1],[386,1],[387,0],[388,0],[389,0],[390,1],[391,0],[392,0],[393,0],[394,0],[395,1],[396,1],[397,0],[398,0],[399,0],[400,0],[401,2],[402,0],[403,0],[404,0],[405,0],[406,1],[407,1],[408,0],[409,0],[410,2],[411,2],[412,0],[413,1],[414,1],[415,0],[416,0],[417,0],[418,0],[419,0],[420,1],[421,0],[422,0],[423,1],[424,0],[425,1],[426,2],[427,0],[428,1],[429,0],[430,0],[431,0],[432,0],[433,0],[434,4],[435,0],[436,1],[437,2],[438,0],[439,0],[440,1],[441,0],[442,0],[443,0],[444,0],[445,0],[446,0],[447,0],[448,0],[449,0],[450,1],[451,0],[452,1],[453,0],[454,0],[455,0],[456,2],[457,1],[458,0],[459,0],[460,0],[461,0],[462,0],[463,1],[464,0],[465,0],[466,0],[467,1],[468,0],[469,0],[470,2],[471,0],[472,1],[473,0],[474,1],[475,1],[476,1],[477,1],[478,0],[479,0],[480,1],[481,0],[482,0],[483,0],[484,1],[485,1],[486,0],[487,0],[488,1],[489,0],[490,1],[491,1],[492,0],[493,0],[494,1],[495,0],[496,0],[497,0],[498,1],[499,0],[500,0],[501,1],[502,0],[503,0],[504,2],[505,0],[506,0],[507,1],[508,0],[509,0],[510,1],[511,1],[512,0],[513,0],[514,0],[515,0],[516,0],[517,1],[518,2],[519,1],[520,0],[521,1],[522,2],[523,0],[524,0],[525,0],[526,1],[527,0],[528,0],[529,1],[530,0],[531,1],[532,0],[533,1],[534,0],[535,0],[536,0],[537,1],[538,0],[539,0],[540,1],[541,0],[542,1],[543,0],[544,0],[545,0],[546,1],[547,1],[548,0],[549,1],[550,0],[551,0],[552,1],[553,1],[554,0],[555,0],[556,2],[557,0],[558,0],[559,0],[560,0],[561,1],[562,0],[563,1],[564,1],[565,0],[566,1],[567,0],[568,1],[569,0],[570,0],[571,0],[572,1],[573,0],[574,0],[575,0],[576,0],[577,0],[578,0],[579,1],[580,0],[581,0],[582,0],[583,2],[584,0],[585,0],[586,1],[587,0],[588,1],[589,0],[590,1],[591,1],[592,0],[593,0],[594,1],[595,0],[596,2],[597,0],[598,0],[599,1],[600,0],[601,0],[602,0],[603,0],[604,0],[605,0],[606,1],[607,0],[608,0],[609,1],[610,0],[611,3],[612,1],[613,1],[614,0],[615,0],[616,0],[617,0],[618,2],[619,0],[620,0],[621,1],[622,0],[623,0],[624,2],[625,1],[626,2],[627,3],[628,1],[629,1],[630,0],[631,0],[632,0],[633,1],[634,0],[635,0],[636,1],[637,0],[638,1],[639,0],[640,0],[641,1],[642,2],[643,0],[644,0],[645,4],[646,0],[647,1],[648,1],[649,1],[650,0],[651,0],[652,1],[653,0],[654,0],[655,0],[656,1],[657,0],[658,1],[659,2],[660,0],[661,0],[662,2],[663,1],[664,1],[665,1],[666,4],[667,1],[668,0],[669,1],[670,0],[671,1],[672,1],[673,0],[674,2],[675,1],[676,1],[677,1],[678,1],[679,1],[680,0],[681,0],[682,0],[683,0],[684,0],[685,2],[686,0],[687,0],[688,0],[689,0],[690,0],[691,0],[692,0],[693,0],[694,0],[695,3],[696,0],[697,0],[698,1],[699,2],[700,0],[701,1],[702,1],[703,0],[704,0],[705,0],[706,1],[707,0],[708,2],[709,0],[710,0],[711,0],[712,1],[713,0],[714,1],[715,0],[716,1],[717,1],[718,1],[719,1],[720,0],[721,1],[722,0],[723,2],[724,2],[725,0],[726,1],[727,4],[728,0],[729,2],[730,0],[731,0],[732,2],[733,0],[734,0],[735,0],[736,1],[737,0],[738,1],[739,0],[740,1],[741,1],[742,0],[743,1],[744,0],[745,1],[746,1],[747,2],[748,0],[749,0],[750,1],[751,0],[752,1],[753,3],[754,1],[755,0],[756,0],[757,0],[758,0],[759,0],[760,1],[761,1],[762,2],[763,2],[764,0],[765,3],[766,1],[767,0],[768,0],[769,0],[770,0],[771,0],[772,0],[773,0],[774,0],[775,0],[776,0],[777,0],[778,0],[779,1],[780,0],[781,2],[782,2],[783,0],[784,1],[785,1],[786,0],[787,0],[788,1],[789,1],[790,1],[791,0],[792,2],[793,1],[794,0],[795,0],[796,0],[797,0],[798,0],[799,2],[800,1],[801,0],[802,2],[803,1],[804,0],[805,0],[806,0],[807,0],[808,1],[809,0],[810,0],[811,2],[812,0],[813,0],[814,4],[815,0],[816,1],[817,1],[818,0],[819,0],[820,0],[821,1],[822,1],[823,0],[824,0],[825,3],[826,0],[827,0],[828,0],[829,0],[830,1],[831,0],[832,2],[833,0],[834,1],[835,0],[836,0],[837,0],[838,0],[839,1],[840,0],[841,0],[842,0],[843,0],[844,1],[845,0],[846,0],[847,0],[848,0],[849,0],[850,2],[851,0],[852,1],[853,0],[854,0],[855,0],[856,0],[857,0],[858,1],[859,0],[860,1],[861,0],[862,0],[863,1],[864,1],[865,0],[866,0],[867,0],[868,2],[869,0],[870,2],[871,1],[872,0],[873,0],[874,0],[875,0],[876,3],[877,0],[878,1],[879,2],[880,2],[881,1],[882,1],[883,2],[884,3],[885,1],[886,0],[887,1],[888,0],[889,0],[890,1],[891,2],[892,0],[893,0],[894,2],[895,1],[896,0],[897,1],[898,2],[899,0],[900,3],[901,0],[902,1],[903,1],[904,0],[905,0],[906,2],[907,0],[908,2],[909,1],[910,1],[911,0],[912,0],[913,0],[914,0],[915,1],[916,0],[917,1],[918,0],[919,1],[920,1],[921,0],[922,2],[923,0],[924,0],[925,1],[926,0],[927,1],[928,1],[929,0],[930,1],[931,0],[932,1],[933,0],[934,0],[935,3],[936,0],[937,0],[938,0],[939,2],[940,0],[941,2],[942,0],[943,2],[944,1],[945,1],[946,0],[947,1],[948,1],[949,0],[950,0],[951,2],[952,4],[953,1],[954,0],[955,1],[956,2],[957,2],[958,0],[959,2],[960,1],[961,0],[962,3],[963,2],[964,0],[965,0],[966,1],[967,1],[968,0],[969,1],[970,1],[971,0],[972,1],[973,0],[974,1],[975,0],[976,0],[977,1],[978,0],[979,0],[980,2],[981,0],[982,1],[983,0],[984,0],[985,2],[986,1],[987,0],[988,1],[989,0],[990,0],[991,0],[992,0],[993,1],[994,0],[995,3],[996,0],[997,1],[998,0],[999,0],[1000,1],[1001,0],[1002,0],[1003,0],[1004,0],[1005,0],[1006,2],[1007,3],[1008,0],[1009,0],[1010,1],[1011,0],[1012,1],[1013,2],[1014,0],[1015,2],[1016,0],[1017,0],[1018,0],[1019,1],[1020,1],[1021,2],[1022,0],[1023,0],[1024,0],[1025,1],[1026,2],[1027,0],[1028,1],[1029,0],[1030,1],[1031,1],[1032,0],[1033,1],[1034,0],[1035,0],[1036,1],[1037,0],[1038,3],[1039,0],[1040,3],[1041,0],[1042,0],[1043,0],[1044,0],[1045,1],[1046,0],[1047,1],[1048,0],[1049,0],[1050,2],[1051,0],[1052,3],[1053,2],[1054,0],[1055,0],[1056,1],[1057,0],[1058,0],[1059,0],[1060,0],[1061,0],[1062,0],[1063,0],[1064,1],[1065,1],[1066,0],[1067,0],[1068,0],[1069,0],[1070,0],[1071,0],[1072,0],[1073,0],[1074,0],[1075,0],[1076,0],[1077,1],[1078,0],[1079,0],[1080,0],[1081,3],[1082,0],[1083,0],[1084,0],[1085,1],[1086,0],[1087,0],[1088,2],[1089,0],[1090,0],[1091,0],[1092,1],[1093,1],[1094,0],[1095,1],[1096,0],[1097,0],[1098,2],[1099,1],[1100,1],[1101,2],[1102,1],[1103,0],[1104,0],[1105,1],[1106,0],[1107,1],[1108,1],[1109,1],[1110,0],[1111,0],[1112,1],[1113,1],[1114,1],[1115,0],[1116,2],[1117,0],[1118,0],[1119,0],[1120,0],[1121,0],[1122,1],[1123,0],[1124,0],[1125,0],[1126,1],[1127,0],[1128,3],[1129,0],[1130,1],[1131,1],[1132,0],[1133,0],[1134,0],[1135,1],[1136,0],[1137,1],[1138,0],[1139,0],[1140,0],[1141,0],[1142,1],[1143,0],[1144,0],[1145,0],[1146,0],[1147,0],[1148,1],[1149,1],[1150,0],[1151,0],[1152,0],[1153,0],[1154,0],[1155,0],[1156,0],[1157,0],[1158,0],[1159,0],[1160,1],[1161,0],[1162,2],[1163,0],[1164,0],[1165,0],[1166,0],[1167,0],[1168,0],[1169,0],[1170,0],[1171,1],[1172,0],[1173,0],[1174,0],[1175,1],[1176,0],[1177,0],[1178,0],[1179,0],[1180,0],[1181,1],[1182,0],[1183,0],[1184,1],[1185,1],[1186,0],[1187,0],[1188,0],[1189,1],[1190,0],[1191,0],[1192,0],[1193,0],[1194,0],[1195,0],[1196,0],[1197,2],[1198,0],[1199,0],[1200,0],[1201,2],[1202,0],[1203,0],[1204,0],[1205,0],[1206,0],[1207,0],[1208,0],[1209,1],[1210,0],[1211,0],[1212,0],[1213,1],[1214,0],[1215,0],[1216,0],[1217,0],[1218,1],[1219,0],[1220,0],[1221,0],[1222,0],[1223,1],[1224,0],[1225,0],[1226,0],[1227,0],[1228,0],[1229,0],[1230,0],[1231,0],[1232,0],[1233,0],[1234,0],[1235,1],[1236,0],[1237,2],[1238,1],[1239,0],[1240,2],[1241,1],[1242,0],[1243,0],[1244,0],[1245,2],[1246,0],[1247,1],[1248,0],[1249,0],[1250,0],[1251,1],[1252,0],[1253,1],[1254,0],[1255,1],[1256,0],[1257,0],[1258,0],[1259,2],[1260,0],[1261,0],[1262,0],[1263,1],[1264,0],[1265,1],[1266,0],[1267,1],[1268,0],[1269,0],[1270,0],[1271,3],[1272,0],[1273,0],[1274,1],[1275,1],[1276,0],[1277,0],[1278,0],[1279,0],[1280,1],[1281,0],[1282,0],[1283,0],[1284,1],[1285,0],[1286,1],[1287,0],[1288,0],[1289,0],[1290,0],[1291,2],[1292,1],[1293,0],[1294,0],[1295,1],[1296,0],[1297,2],[1298,1],[1299,0],[1300,1],[1301,2],[1302,0],[1303,0],[1304,4],[1305,0],[1306,1],[1307,0],[1308,2],[1309,0],[1310,3],[1311,1],[1312,0],[1313,0],[1314,0],[1315,0],[1316,1],[1317,0],[1318,0],[1319,0],[1320,0],[1321,1],[1322,0],[1323,0],[1324,1],[1325,0],[1326,2],[1327,0],[1328,0],[1329,0],[1330,0],[1331,0],[1332,0],[1333,0],[1334,0],[1335,1],[1336,1],[1337,0],[1338,0],[1339,0],[1340,0],[1341,0],[1342,0],[1343,3],[1344,1],[1345,0],[1346,2],[1347,0],[1348,0],[1349,2],[1350,0],[1351,0],[1352,1],[1353,0],[1354,0],[1355,0],[1356,1],[1357,1],[1358,0],[1359,0],[1360,0],[1361,0],[1362,0],[1363,0],[1364,0],[1365,0],[1366,0],[1367,0],[1368,0],[1369,0],[1370,0],[1371,0],[1372,0],[1373,0],[1374,0],[1375,0],[1376,0],[1377,1],[1378,0],[1379,0],[1380,1],[1381,1],[1382,0],[1383,0],[1384,1],[1385,1],[1386,3],[1387,1],[1388,0],[1389,1],[1390,0],[1391,0],[1392,0],[1393,1],[1394,0],[1395,1],[1396,0],[1397,0],[1398,0],[1399,0],[1400,0],[1401,1],[1402,0],[1403,1],[1404,0],[1405,0],[1406,1],[1407,0],[1408,0],[1409,0],[1410,2],[1411,0],[1412,0],[1413,0],[1414,1],[1415,0],[1416,0],[1417,0],[1418,1],[1419,0],[1420,0],[1421,2],[1422,1],[1423,0],[1424,0],[1425,0],[1426,0],[1427,1],[1428,0],[1429,0],[1430,0],[1431,0],[1432,1],[1433,0],[1434,1],[1435,2],[1436,0],[1437,1],[1438,0],[1439,0],[1440,0],[1441,2],[1442,0],[1443,0],[1444,1],[1445,0],[1446,1],[1447,0],[1448,0],[1449,0],[1450,0],[1451,1],[1452,0],[1453,1],[1454,0],[1455,1],[1456,0],[1457,0],[1458,0],[1459,0],[1460,2],[1461,0],[1462,0],[1463,1],[1464,0],[1465,0],[1466,2],[1467,0],[1468,1],[1469,0],[1470,0],[1471,1],[1472,0],[1473,0],[1474,0],[1475,1],[1476,0],[1477,0],[1478,1],[1479,0],[1480,0],[1481,0],[1482,0],[1483,0],[1484,0],[1485,0],[1486,2],[1487,0],[1488,2],[1489,1],[1490,0],[1491,0],[1492,1],[1493,0],[1494,1],[1495,0],[1496,0],[1497,2],[1498,1],[1499,2],[1500,0],[1501,0],[1502,0],[1503,1],[1504,0],[1505,2],[1506,0],[1507,1],[1508,1],[1509,0],[1510,0],[1511,1],[1512,0],[1513,1],[1514,0],[1515,0],[1516,1],[1517,0],[1518,0],[1519,1],[1520,0],[1521,0],[1522,1],[1523,0],[1524,0],[1525,0],[1526,1],[1527,0],[1528,0],[1529,2],[1530,0],[1531,0],[1532,0],[1533,5],[1534,1],[1535,0],[1536,2],[1537,0],[1538,0],[1539,0],[1540,0],[1541,0],[1542,3],[1543,0],[1544,0],[1545,1],[1546,1],[1547,0],[1548,0],[1549,3],[1550,0],[1551,0],[1552,2],[1553,0],[1554,0],[1555,0],[1556,0],[1557,1],[1558,0],[1559,0],[1560,1],[1561,0],[1562,1],[1563,0],[1564,0],[1565,0],[1566,0],[1567,0],[1568,2],[1569,1],[1570,0],[1571,0],[1572,0],[1573,0],[1574,0],[1575,0],[1576,0],[1577,0],[1578,0],[1579,0],[1580,0],[1581,0],[1582,2],[1583,1],[1584,1],[1585,0],[1586,3],[1587,0],[1588,0],[1589,0],[1590,0],[1591,0],[1592,0],[1593,0],[1594,0],[1595,0],[1596,1],[1597,0],[1598,0],[1599,0],[1600,1],[1601,0],[1602,0],[1603,0],[1604,0],[1605,3],[1606,0],[1607,0],[1608,1],[1609,1],[1610,1],[1611,0],[1612,2],[1613,0],[1614,0],[1615,0],[1616,1],[1617,0],[1618,1],[1619,0],[1620,0],[1621,0],[1622,0],[1623,0],[1624,2],[1625,0],[1626,1],[1627,1],[1628,1],[1629,0],[1630,1],[1631,0],[1632,0],[1633,1],[1634,0],[1635,0],[1636,0],[1637,0],[1638,2],[1639,2],[1640,2],[1641,0],[1642,1],[1643,1],[1644,2],[1645,1],[1646,1],[1647,0],[1648,0],[1649,1],[1650,3],[1651,0],[1652,0],[1653,0],[1654,1],[1655,0],[1656,0],[1657,0],[1658,0],[1659,0],[1660,0],[1661,0],[1662,0],[1663,0],[1664,2],[1665,0],[1666,2],[1667,1],[1668,0],[1669,0],[1670,0],[1671,0],[1672,0],[1673,1],[1674,1],[1675,0],[1676,0],[1677,0],[1678,0],[1679,0],[1680,2],[1681,0],[1682,1],[1683,0],[1684,0],[1685,1],[1686,0],[1687,1],[1688,0],[1689,1],[1690,0],[1691,1],[1692,1],[1693,0],[1694,0],[1695,0],[1696,0],[1697,1],[1698,0],[1699,0],[1700,0],[1701,0],[1702,1],[1703,0],[1704,0],[1705,0],[1706,1],[1707,0],[1708,2],[1709,1],[1710,0],[1711,0],[1712,0],[1713,0],[1714,1],[1715,0],[1716,2],[1717,0],[1718,1],[1719,0],[1720,0],[1721,0],[1722,0],[1723,0],[1724,0],[1725,1],[1726,0],[1727,3],[1728,0],[1729,0],[1730,1],[1731,0],[1732,0],[1733,1],[1734,2],[1735,2],[1736,0],[1737,1],[1738,0],[1739,0],[1740,1],[1741,1],[1742,0],[1743,1],[1744,0],[1745,1],[1746,2],[1747,0],[1748,0],[1749,2],[1750,0],[1751,0],[1752,1],[1753,0],[1754,0],[1755,0],[1756,0],[1757,0],[1758,0],[1759,1],[1760,1],[1761,0],[1762,1],[1763,0],[1764,1],[1765,0],[1766,0],[1767,0],[1768,0],[1769,0],[1770,1],[1771,0],[1772,0],[1773,2],[1774,1],[1775,0],[1776,1],[1777,0],[1778,0],[1779,1],[1780,1],[1781,1],[1782,0],[1783,0],[1784,0],[1785,1],[1786,0],[1787,1],[1788,0],[1789,1],[1790,0],[1791,0],[1792,2],[1793,0],[1794,1],[1795,0],[1796,2],[1797,0],[1798,0],[1799,1],[1800,0],[1801,0],[1802,1],[1803,0],[1804,1],[1805,1],[1806,2],[1807,1],[1808,0],[1809,0],[1810,0],[1811,0],[1812,1],[1813,0],[1814,2],[1815,0],[1816,0],[1817,0],[1818,0],[1819,1],[1820,1],[1821,0],[1822,0],[1823,1],[1824,0],[1825,2],[1826,0],[1827,0],[1828,0],[1829,0],[1830,0],[1831,0],[1832,3],[1833,0],[1834,0],[1835,1],[1836,0],[1837,1],[1838,0],[1839,0],[1840,0],[1841,2],[1842,1],[1843,0],[1844,0],[1845,0],[1846,1],[1847,2],[1848,0],[1849,0],[1850,0],[1851,0],[1852,1],[1853,0],[1854,1],[1855,0],[1856,1],[1857,3],[1858,0],[1859,2],[1860,0],[1861,0],[1862,0],[1863,0],[1864,3],[1865,0],[1866,3],[1867,2],[1868,0],[1869,0],[1870,0],[1871,0],[1872,1],[1873,2],[1874,0],[1875,1],[1876,0],[1877,0],[1878,0],[1879,1],[1880,1],[1881,0],[1882,0],[1883,0],[1884,0],[1885,0],[1886,0],[1887,0],[1888,0],[1889,1],[1890,1],[1891,2],[1892,0],[1893,1],[1894,0],[1895,1],[1896,1],[1897,0],[1898,1],[1899,0],[1900,1],[1901,1],[1902,0],[1903,1],[1904,0],[1905,1],[1906,0],[1907,2],[1908,0],[1909,1],[1910,0],[1911,0],[1912,0],[1913,1],[1914,1],[1915,0],[1916,0],[1917,0],[1918,0],[1919,1],[1920,1],[1921,0],[1922,0],[1923,0],[1924,0],[1925,0],[1926,1],[1927,0],[1928,0],[1929,1],[1930,1],[1931,0],[1932,0],[1933,0],[1934,0],[1935,0],[1936,1],[1937,0],[1938,1],[1939,0],[1940,0],[1941,0],[1942,0],[1943,0],[1944,0],[1945,2],[1946,1],[1947,0],[1948,0],[1949,1],[1950,0],[1951,0],[1952,0],[1953,0],[1954,0],[1955,0],[1956,0],[1957,1],[1958,0],[1959,2],[1960,0],[1961,1],[1962,2],[1963,1],[1964,0],[1965,2],[1966,1],[1967,0],[1968,0],[1969,1],[1970,2],[1971,0],[1972,0],[1973,0],[1974,0],[1975,0],[1976,1],[1977,0],[1978,1],[1979,0],[1980,0],[1981,0],[1982,0],[1983,0],[1984,1],[1985,0],[1986,0],[1987,0],[1988,0],[1989,1],[1990,0],[1991,0],[1992,2],[1993,0],[1994,0],[1995,0],[1996,0],[1997,0],[1998,0],[1999,0],[2000,0],[2001,2],[2002,0],[2003,0],[2004,0],[2005,0],[2006,2],[2007,0],[2008,0],[2009,0],[2010,1],[2011,1],[2012,0],[2013,0],[2014,1],[2015,0],[2016,0],[2017,1],[2018,1],[2019,1],[2020,0],[2021,1],[2022,0],[2023,0],[2024,1],[2025,1],[2026,0],[2027,1],[2028,1],[2029,1],[2030,1],[2031,0],[2032,1],[2033,2],[2034,1],[2035,0],[2036,1],[2037,0],[2038,0],[2039,0],[2040,0],[2041,1],[2042,0],[2043,1],[2044,1],[2045,2],[2046,0],[2047,0],[2048,1],[2049,0],[2050,0],[2051,0],[2052,1],[2053,2],[2054,0],[2055,0],[2056,0],[2057,0],[2058,0],[2059,0],[2060,0],[2061,1],[2062,0],[2063,0],[2064,0],[2065,2],[2066,0],[2067,0],[2068,1],[2069,0],[2070,1],[2071,1],[2072,0],[2073,0],[2074,0],[2075,0],[2076,0],[2077,0],[2078,0],[2079,0],[2080,0],[2081,0],[2082,0],[2083,0],[2084,0],[2085,2],[2086,0],[2087,3],[2088,2],[2089,1],[2090,0],[2091,1],[2092,0],[2093,1],[2094,0],[2095,0],[2096,1],[2097,1],[2098,0],[2099,1],[2100,0],[2101,1],[2102,0],[2103,0],[2104,0],[2105,0],[2106,0],[2107,1],[2108,1],[2109,0],[2110,0],[2111,0],[2112,2],[2113,0],[2114,0],[2115,1],[2116,1],[2117,0],[2118,0],[2119,1],[2120,0],[2121,0],[2122,2],[2123,0],[2124,0],[2125,3],[2126,0],[2127,0],[2128,1],[2129,2],[2130,0],[2131,1],[2132,0],[2133,0],[2134,0],[2135,0],[2136,0],[2137,1],[2138,2],[2139,0],[2140,0],[2141,0],[2142,0],[2143,0],[2144,0],[2145,0],[2146,1],[2147,0],[2148,0],[2149,0],[2150,2],[2151,0],[2152,0],[2153,1],[2154,1],[2155,1],[2156,0],[2157,0],[2158,1],[2159,0],[2160,0],[2161,0],[2162,1],[2163,0],[2164,0],[2165,1],[2166,1],[2167,1],[2168,0],[2169,0],[2170,0],[2171,0],[2172,0],[2173,0],[2174,1],[2175,0],[2176,1],[2177,0],[2178,1],[2179,1],[2180,0],[2181,0],[2182,2],[2183,0],[2184,0],[2185,1],[2186,0],[2187,0],[2188,0],[2189,0],[2190,1],[2191,0],[2192,0],[2193,0],[2194,3],[2195,1],[2196,0],[2197,0],[2198,0],[2199,3],[2200,0],[2201,2],[2202,0],[2203,1],[2204,0],[2205,0],[2206,0],[2207,1],[2208,0],[2209,0],[2210,0],[2211,0],[2212,1],[2213,0],[2214,1],[2215,0],[2216,0],[2217,0],[2218,0],[2219,0],[2220,4],[2221,0],[2222,0],[2223,0],[2224,2],[2225,0],[2226,1],[2227,0],[2228,0],[2229,1],[2230,1],[2231,0],[2232,1],[2233,0],[2234,0],[2235,0],[2236,1],[2237,0],[2238,0],[2239,0],[2240,0],[2241,0],[2242,0],[2243,0],[2244,2],[2245,0],[2246,0],[2247,0],[2248,2],[2249,0],[2250,0],[2251,2],[2252,0],[2253,0],[2254,2],[2255,0],[2256,0],[2257,0],[2258,0],[2259,0],[2260,0],[2261,0],[2262,0],[2263,1],[2264,0],[2265,0],[2266,0],[2267,1],[2268,0],[2269,0],[2270,0],[2271,0],[2272,0],[2273,0],[2274,0],[2275,0],[2276,1],[2277,0],[2278,2],[2279,4],[2280,2],[2281,1],[2282,0],[2283,0],[2284,1],[2285,1],[2286,0],[2287,0],[2288,3],[2289,0],[2290,1],[2291,1],[2292,0],[2293,1],[2294,0],[2295,0],[2296,2],[2297,0],[2298,1],[2299,2],[2300,0],[2301,0],[2302,0],[2303,0],[2304,0],[2305,1],[2306,0],[2307,0],[2308,0],[2309,0],[2310,0],[2311,1],[2312,0],[2313,0],[2314,0],[2315,1],[2316,0],[2317,2],[2318,0],[2319,0],[2320,0],[2321,0],[2322,1],[2323,0],[2324,0],[2325,0],[2326,0],[2327,0],[2328,0],[2329,2],[2330,1],[2331,0],[2332,1],[2333,0],[2334,1],[2335,1],[2336,2],[2337,0],[2338,0],[2339,0],[2340,1],[2341,0],[2342,0],[2343,0],[2344,0],[2345,0],[2346,3],[2347,0],[2348,1],[2349,0],[2350,0],[2351,0],[2352,1],[2353,0],[2354,0],[2355,1],[2356,0],[2357,0],[2358,1],[2359,0],[2360,0],[2361,1],[2362,1],[2363,0],[2364,0],[2365,1],[2366,0],[2367,0],[2368,1],[2369,0],[2370,2],[2371,0],[2372,2],[2373,0],[2374,2],[2375,0],[2376,0],[2377,1],[2378,0],[2379,0],[2380,0],[2381,0],[2382,0],[2383,0],[2384,0],[2385,0],[2386,0],[2387,1],[2388,1],[2389,0],[2390,0],[2391,2],[2392,0],[2393,1],[2394,0],[2395,0],[2396,0],[2397,0],[2398,0],[2399,1],[2400,0],[2401,0],[2402,1],[2403,0],[2404,0],[2405,0],[2406,1],[2407,1],[2408,0],[2409,0],[2410,0],[2411,1],[2412,0],[2413,0],[2414,0],[2415,1],[2416,0],[2417,0],[2418,1],[2419,1],[2420,0],[2421,0],[2422,1],[2423,1],[2424,1],[2425,0],[2426,0],[2427,0],[2428,0],[2429,1],[2430,0],[2431,0],[2432,1],[2433,1],[2434,1],[2435,1],[2436,0],[2437,0],[2438,2],[2439,0],[2440,1],[2441,0],[2442,0],[2443,1],[2444,0],[2445,0],[2446,0],[2447,0],[2448,1],[2449,0],[2450,0],[2451,0],[2452,0],[2453,0],[2454,1],[2455,0],[2456,0],[2457,0],[2458,2],[2459,0],[2460,0],[2461,0],[2462,0],[2463,1],[2464,0],[2465,0],[2466,0],[2467,0],[2468,0],[2469,0],[2470,1],[2471,0],[2472,3],[2473,0],[2474,0],[2475,0],[2476,0],[2477,1],[2478,0],[2479,1],[2480,0],[2481,0],[2482,0],[2483,0],[2484,1],[2485,1],[2486,0],[2487,1],[2488,1],[2489,2],[2490,0],[2491,0],[2492,0],[2493,0],[2494,2],[2495,1],[2496,2],[2497,0],[2498,1],[2499,0],[2500,1],[2501,0],[2502,1],[2503,1],[2504,0],[2505,0],[2506,1],[2507,0],[2508,0],[2509,1],[2510,0],[2511,1],[2512,0],[2513,0],[2514,0],[2515,0],[2516,0],[2517,0],[2518,1],[2519,0],[2520,0],[2521,0],[2522,2],[2523,0],[2524,1],[2525,0],[2526,0],[2527,0],[2528,1],[2529,0],[2530,0],[2531,1],[2532,2],[2533,0],[2534,1],[2535,0],[2536,0],[2537,0],[2538,1],[2539,0],[2540,0],[2541,0],[2542,0],[2543,0],[2544,2],[2545,3],[2546,0],[2547,0],[2548,1],[2549,1],[2550,3],[2551,1],[2552,0],[2553,0],[2554,0],[2555,0],[2556,0],[2557,0],[2558,0],[2559,0],[2560,0],[2561,0],[2562,2],[2563,0],[2564,0],[2565,0],[2566,1],[2567,0],[2568,0],[2569,3],[2570,0],[2571,0],[2572,2],[2573,1],[2574,0],[2575,0],[2576,1],[2577,1],[2578,1],[2579,1],[2580,1],[2581,1],[2582,2],[2583,0],[2584,0],[2585,0],[2586,1],[2587,1],[2588,0],[2589,0],[2590,0],[2591,1],[2592,0],[2593,3],[2594,0],[2595,1],[2596,1],[2597,0],[2598,0],[2599,0],[2600,0],[2601,0],[2602,0],[2603,0],[2604,3],[2605,0],[2606,0],[2607,0],[2608,0],[2609,0],[2610,0],[2611,0],[2612,0],[2613,0],[2614,2],[2615,0],[2616,0],[2617,0],[2618,0],[2619,0],[2620,2],[2621,0],[2622,1],[2623,0],[2624,0],[2625,2],[2626,0],[2627,0],[2628,1],[2629,2],[2630,0],[2631,0],[2632,0],[2633,0],[2634,0],[2635,0],[2636,1],[2637,1],[2638,0],[2639,0],[2640,0],[2641,0],[2642,1],[2643,0],[2644,0],[2645,1],[2646,0],[2647,1],[2648,0],[2649,1],[2650,0],[2651,0],[2652,0],[2653,0],[2654,0],[2655,0],[2656,0],[2657,0],[2658,2],[2659,0],[2660,1],[2661,0],[2662,3],[2663,0],[2664,0],[2665,0],[2666,2],[2667,0],[2668,0],[2669,0],[2670,0],[2671,0],[2672,1],[2673,1],[2674,0],[2675,1],[2676,0],[2677,1],[2678,1],[2679,0],[2680,0],[2681,0],[2682,0],[2683,0],[2684,1],[2685,0],[2686,1],[2687,0],[2688,0],[2689,0],[2690,0],[2691,1],[2692,0],[2693,1],[2694,0],[2695,2],[2696,0],[2697,0],[2698,0],[2699,0],[2700,0],[2701,0],[2702,0],[2703,0],[2704,0],[2705,1],[2706,0],[2707,0],[2708,1],[2709,0],[2710,0],[2711,0],[2712,0],[2713,0],[2714,1],[2715,0],[2716,2],[2717,0],[2718,0],[2719,2],[2720,0],[2721,0],[2722,1],[2723,0],[2724,0],[2725,0],[2726,0],[2727,0],[2728,1],[2729,1],[2730,0],[2731,0],[2732,0],[2733,1],[2734,0],[2735,0],[2736,1],[2737,0],[2738,0],[2739,0],[2740,0],[2741,0],[2742,1],[2743,0],[2744,2],[2745,0],[2746,0],[2747,0],[2748,1],[2749,2],[2750,0],[2751,0],[2752,0],[2753,1],[2754,1],[2755,0],[2756,1],[2757,1],[2758,1],[2759,0],[2760,2],[2761,1],[2762,0],[2763,1],[2764,1],[2765,0],[2766,1],[2767,0],[2768,0],[2769,0],[2770,0],[2771,0],[2772,0],[2773,2],[2774,0],[2775,0],[2776,3],[2777,0],[2778,0],[2779,0],[2780,1],[2781,0],[2782,0],[2783,2],[2784,0],[2785,0],[2786,2],[2787,0],[2788,0],[2789,1],[2790,1],[2791,1],[2792,0],[2793,1],[2794,0],[2795,0],[2796,1],[2797,0],[2798,2],[2799,1],[2800,0],[2801,1],[2802,0],[2803,1],[2804,0],[2805,0],[2806,2],[2807,0],[2808,1],[2809,0],[2810,0],[2811,0],[2812,0],[2813,0],[2814,1],[2815,0],[2816,0],[2817,1],[2818,0],[2819,0],[2820,2],[2821,0],[2822,0],[2823,2],[2824,0],[2825,0],[2826,0],[2827,1],[2828,0],[2829,0],[2830,0],[2831,0],[2832,0],[2833,0],[2834,2],[2835,0],[2836,1],[2837,0],[2838,0],[2839,1],[2840,0],[2841,2],[2842,1],[2843,0],[2844,1],[2845,0],[2846,0],[2847,0],[2848,0],[2849,0],[2850,2],[2851,0],[2852,1],[2853,0],[2854,1],[2855,0],[2856,0],[2857,2],[2858,1],[2859,0],[2860,0],[2861,0],[2862,0],[2863,1],[2864,3],[2865,1],[2866,2],[2867,0],[2868,1],[2869,4],[2870,0],[2871,0],[2872,0],[2873,0],[2874,0],[2875,0],[2876,0],[2877,0],[2878,0],[2879,1],[2880,0],[2881,1],[2882,0],[2883,1],[2884,0],[2885,1],[2886,1],[2887,3],[2888,0],[2889,0],[2890,1],[2891,1],[2892,0],[2893,1],[2894,1],[2895,1],[2896,1],[2897,2],[2898,0],[2899,1],[2900,1],[2901,1],[2902,1],[2903,1],[2904,2],[2905,2],[2906,0],[2907,0],[2908,2],[2909,1],[2910,0],[2911,1],[2912,0],[2913,0],[2914,0],[2915,1],[2916,2],[2917,2],[2918,0],[2919,1],[2920,2],[2921,1],[2922,2],[2923,2],[2924,1],[2925,0],[2926,0],[2927,0],[2928,0],[2929,0],[2930,2],[2931,0],[2932,1],[2933,1],[2934,0],[2935,1],[2936,0],[2937,0],[2938,0],[2939,0],[2940,0],[2941,0],[2942,1],[2943,1],[2944,0],[2945,1],[2946,0],[2947,0],[2948,0],[2949,0],[2950,0],[2951,1],[2952,0],[2953,0],[2954,0],[2955,1],[2956,1],[2957,2],[2958,1],[2959,0],[2960,1],[2961,1],[2962,1],[2963,0],[2964,0],[2965,1],[2966,0],[2967,0],[2968,2],[2969,0],[2970,0],[2971,0],[2972,1],[2973,0],[2974,0],[2975,2],[2976,3],[2977,2],[2978,0],[2979,3],[2980,0],[2981,1],[2982,1],[2983,1],[2984,4],[2985,1],[2986,1],[2987,0],[2988,1],[2989,0],[2990,2],[2991,2],[2992,3],[2993,1],[2994,1],[2995,3],[2996,2],[2997,2],[2998,1],[2999,4],[3000,1],[3001,2],[3002,1],[3003,0],[3004,0],[3005,0],[3006,1],[3007,1],[3008,4],[3009,0],[3010,3],[3011,1],[3012,1],[3013,0],[3014,1],[3015,0],[3016,1],[3017,3],[3018,2],[3019,2],[3020,1],[3021,4],[3022,1],[3023,2],[3024,0],[3025,1],[3026,4],[3027,1],[3028,3],[3029,0],[3030,1],[3031,0],[3032,0],[3033,0],[3034,0],[3035,1],[3036,0],[3037,1],[3038,0],[3039,2],[3040,0],[3041,1],[3042,1],[3043,1],[3044,1],[3045,0],[3046,2],[3047,0],[3048,3],[3049,0],[3050,0],[3051,0],[3052,1],[3053,1],[3054,0],[3055,1],[3056,3],[3057,0],[3058,0],[3059,1],[3060,2],[3061,0],[3062,1],[3063,0],[3064,0],[3065,1],[3066,0],[3067,2],[3068,1],[3069,0],[3070,0],[3071,1],[3072,0],[3073,1],[3074,1],[3075,0],[3076,0],[3077,0],[3078,0],[3079,0],[3080,1],[3081,1],[3082,4],[3083,1],[3084,0],[3085,2],[3086,0],[3087,1],[3088,0],[3089,0],[3090,0],[3091,1],[3092,1],[3093,0],[3094,1],[3095,0],[3096,2],[3097,0],[3098,3],[3099,0],[3100,1],[3101,1],[3102,0],[3103,0],[3104,2],[3105,1],[3106,0],[3107,1],[3108,0],[3109,1],[3110,0],[3111,2],[3112,0],[3113,1],[3114,2],[3115,0],[3116,2],[3117,1],[3118,0],[3119,1],[3120,0],[3121,2],[3122,1],[3123,1],[3124,1],[3125,1],[3126,1],[3127,0],[3128,1],[3129,2],[3130,1],[3131,0],[3132,0],[3133,0],[3134,1],[3135,2],[3136,1],[3137,1],[3138,0],[3139,1],[3140,0],[3141,0],[3142,0],[3143,1],[3144,2],[3145,1],[3146,2],[3147,0],[3148,0],[3149,1],[3150,4],[3151,0],[3152,0],[3153,0],[3154,1],[3155,4],[3156,2],[3157,3],[3158,2],[3159,3],[3160,2],[3161,0],[3162,0],[3163,3],[3164,0],[3165,4],[3166,0],[3167,1],[3168,3],[3169,0],[3170,0],[3171,0],[3172,2],[3173,2],[3174,1],[3175,1],[3176,0],[3177,0],[3178,1],[3179,2],[3180,0],[3181,2],[3182,1],[3183,1],[3184,1],[3185,1],[3186,3],[3187,0],[3188,0],[3189,1],[3190,3],[3191,4],[3192,0],[3193,0],[3194,0],[3195,0],[3196,1],[3197,2],[3198,8],[3199,3],[3200,0],[3201,0],[3202,1],[3203,0],[3204,1],[3205,1],[3206,1],[3207,4],[3208,2],[3209,4],[3210,2],[3211,0],[3212,2],[3213,1],[3214,0],[3215,0],[3216,0],[3217,0],[3218,2],[3219,0],[3220,2],[3221,1],[3222,1],[3223,2],[3224,3],[3225,3],[3226,5],[3227,0],[3228,3],[3229,2],[3230,0],[3231,1],[3232,1],[3233,1],[3234,2],[3235,0],[3236,1],[3237,3],[3238,0],[3239,2],[3240,0],[3241,1],[3242,2],[3243,0],[3244,4],[3245,0],[3246,1],[3247,1],[3248,2],[3249,4],[3250,0],[3251,0],[3252,0],[3253,0],[3254,0],[3255,0],[3256,0],[3257,0],[3258,1],[3259,0],[3260,1],[3261,0],[3262,0],[3263,1],[3264,1],[3265,1],[3266,0],[3267,1],[3268,0],[3269,0],[3270,1],[3271,0],[3272,1],[3273,1],[3274,0],[3275,0],[3276,1],[3277,2],[3278,0],[3279,1],[3280,3],[3281,0],[3282,1],[3283,0],[3284,0],[3285,0],[3286,0],[3287,0],[3288,0],[3289,1],[3290,0],[3291,1],[3292,0],[3293,0],[3294,1],[3295,0],[3296,0],[3297,0],[3298,0],[3299,1],[3300,0],[3301,0],[3302,0],[3303,0],[3304,1],[3305,1],[3306,1],[3307,0],[3308,3],[3309,0],[3310,1],[3311,0],[3312,1],[3313,1],[3314,0],[3315,1],[3316,2],[3317,0],[3318,0],[3319,0],[3320,0],[3321,2],[3322,0],[3323,0],[3324,1],[3325,0],[3326,2],[3327,0],[3328,0],[3329,0],[3330,0],[3331,1],[3332,0],[3333,0],[3334,0],[3335,1],[3336,0],[3337,0],[3338,1],[3339,0],[3340,1],[3341,0],[3342,1],[3343,0],[3344,4],[3345,0],[3346,2],[3347,0],[3348,1],[3349,1],[3350,0],[3351,1],[3352,0],[3353,0],[3354,0],[3355,1],[3356,2],[3357,2],[3358,1],[3359,0],[3360,1],[3361,1],[3362,0],[3363,0],[3364,2],[3365,0],[3366,1],[3367,2],[3368,1],[3369,1],[3370,0],[3371,0],[3372,0],[3373,0],[3374,0],[3375,0],[3376,0],[3377,2],[3378,0],[3379,0],[3380,0],[3381,0],[3382,1],[3383,1],[3384,0],[3385,0],[3386,0],[3387,0],[3388,0],[3389,0],[3390,3],[3391,1],[3392,1],[3393,0],[3394,0],[3395,0],[3396,1],[3397,0],[3398,0],[3399,0],[3400,2],[3401,0],[3402,0],[3403,1],[3404,0],[3405,0],[3406,0],[3407,0],[3408,2],[3409,0],[3410,0],[3411,2],[3412,1],[3413,1],[3414,2],[3415,2],[3416,1],[3417,0],[3418,0],[3419,0],[3420,1],[3421,0],[3422,0],[3423,2],[3424,0],[3425,1],[3426,1],[3427,0],[3428,1],[3429,0],[3430,0],[3431,1],[3432,1],[3433,1],[3434,0],[3435,3],[3436,0],[3437,1],[3438,0],[3439,0],[3440,2],[3441,0],[3442,1],[3443,1],[3444,0],[3445,1],[3446,2],[3447,0],[3448,0],[3449,2],[3450,0],[3451,0],[3452,0],[3453,1],[3454,0],[3455,0],[3456,1],[3457,1],[3458,0],[3459,1],[3460,0],[3461,0],[3462,0],[3463,1],[3464,1],[3465,0],[3466,1],[3467,1],[3468,0],[3469,0],[3470,3],[3471,0],[3472,0],[3473,1],[3474,0],[3475,1],[3476,1],[3477,1],[3478,0],[3479,0],[3480,1],[3481,0],[3482,0],[3483,2],[3484,2],[3485,1],[3486,0],[3487,1],[3488,0],[3489,1],[3490,0],[3491,0],[3492,0],[3493,0],[3494,0],[3495,1],[3496,0],[3497,0],[3498,0],[3499,0],[3500,0],[3501,0],[3502,1],[3503,0],[3504,1],[3505,0],[3506,1],[3507,0],[3508,0],[3509,0],[3510,0],[3511,1],[3512,1],[3513,0],[3514,1],[3515,0],[3516,0],[3517,0],[3518,1],[3519,2],[3520,0],[3521,0],[3522,1],[3523,1],[3524,1],[3525,1],[3526,2],[3527,0],[3528,3],[3529,0],[3530,1],[3531,1],[3532,0],[3533,0],[3534,1],[3535,0],[3536,1],[3537,0],[3538,0],[3539,1],[3540,0],[3541,0],[3542,0],[3543,1],[3544,1],[3545,1],[3546,0],[3547,1],[3548,0],[3549,1],[3550,2],[3551,0],[3552,0],[3553,1],[3554,0],[3555,1],[3556,0],[3557,0],[3558,0],[3559,1],[3560,1],[3561,1],[3562,2],[3563,1],[3564,1],[3565,0],[3566,0],[3567,0],[3568,1],[3569,0],[3570,0],[3571,1],[3572,1],[3573,0]
];


const BBJ_INTERVALS: { interval: number; bbjCount: number; startHand: number; endHand: number }[] = 
  BBJ_INTERVALS_RAW.map(([interval, bbjCount]) => ({
    interval,
    bbjCount,
    startHand: (interval - 1) * 50000 + 1,
    endHand: interval * 50000,
  }));

// ============================================
// ANIMATION VARIANTS
// ============================================

const fadeInUp = {
  hidden: { opacity: 0, y: 30 },
  visible: { 
    opacity: 1, 
    y: 0,
    transition: { duration: 0.6, ease: [0.22, 1, 0.36, 1] }
  }
};

const fadeIn = {
  hidden: { opacity: 0 },
  visible: { 
    opacity: 1,
    transition: { duration: 0.5, ease: 'easeOut' }
  }
};

const staggerContainer = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.1
    }
  }
};

const scaleIn = {
  hidden: { opacity: 0, scale: 0.95 },
  visible: { 
    opacity: 1, 
    scale: 1,
    transition: { duration: 0.5, ease: [0.22, 1, 0.36, 1] }
  }
};

// ============================================
// HELPER COMPONENTS (outside main to prevent re-render)
// ============================================

// Progress bar component
const ProgressBar = ({ value, max, color, showLabel = true }: { value: number; max: number; color: string; showLabel?: boolean }) => {
  const percentage = Math.min((value / max) * 100, 100);
  return (
    <div className="w-full">
      <div className="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
        <motion.div 
          className="h-full rounded-full"
          style={{ background: `linear-gradient(90deg, ${color}88, ${color})` }}
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: 0.5, ease: 'easeOut' }}
        />
      </div>
      {showLabel && (
        <div className="text-[11px] text-zinc-500 mt-1 text-right">
          {percentage.toFixed(1)}%
        </div>
      )}
    </div>
  );
};

// Gauge component for EV visualization
const EVGauge = ({ value, min, max }: { value: number; min: number; max: number }) => {
  const range = max - min;
  const normalizedValue = ((value - min) / range) * 100;
  const clampedValue = Math.max(0, Math.min(100, normalizedValue));
  
  const getGaugeColor = (pct: number): string => {
    if (pct < 50) {
      const red = 239;
      const green = Math.round(68 + (pct / 50) * 187);
      return `rgb(${red}, ${green}, 68)`;
    } else {
      const red = Math.round(255 - ((pct - 50) / 50) * 221);
      const green = Math.round(255 - ((pct - 50) / 50) * 60);
      return `rgb(${red}, ${green}, 94)`;
    }
  };

  return (
    <div className="relative w-full h-[120px]">
      <svg viewBox="0 0 200 100" className="w-full h-full">
        <path
          d="M 20 90 A 80 80 0 0 1 180 90"
          fill="none"
          stroke="rgba(255,255,255,0.1)"
          strokeWidth="12"
          strokeLinecap="round"
        />
        <motion.path
          d="M 20 90 A 80 80 0 0 1 180 90"
          fill="none"
          stroke={getGaugeColor(clampedValue)}
          strokeWidth="12"
          strokeLinecap="round"
          strokeDasharray={`${clampedValue * 2.51} 251`}
          initial={{ strokeDasharray: '0 251' }}
          animate={{ strokeDasharray: `${clampedValue * 2.51} 251` }}
          transition={{ duration: 0.8, ease: 'easeOut' }}
        />
        <text
          x="100"
          y="70"
          textAnchor="middle"
          fill={getGaugeColor(clampedValue)}
          fontSize="24"
          fontWeight="700"
          className="font-bold"
        >
          {value >= 0 ? '+' : ''}{value.toFixed(2)}
        </text>
        <text
          x="100"
          y="88"
          textAnchor="middle"
          fill="rgba(255,255,255,0.5)"
          fontSize="12"
        >
          bb/100
        </text>
        <text x="20" y="98" textAnchor="middle" fill="rgba(255,255,255,0.4)" fontSize="10">
          {min.toFixed(1)}
        </text>
        <text x="180" y="98" textAnchor="middle" fill="rgba(255,255,255,0.4)" fontSize="10">
          +{max.toFixed(1)}
        </text>
      </svg>
    </div>
  );
};

// BBJ Distribution Barcode Graph - True barcode style visualization
const BBJBarcodeGraph = () => {
  const [hoveredBin, setHoveredBin] = useState<number | null>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  
  // Aggregate intervals into bins for display (target ~300 bins for good visual density)
  const BINS_COUNT = 300;
  const intervalsPerBin = Math.ceil(BBJ_INTERVALS.length / BINS_COUNT);
  
  const aggregatedBins = useMemo(() => {
    const bins: { binIndex: number; bbjCount: number; startInterval: number; endInterval: number; startHand: number; endHand: number }[] = [];
    
    for (let i = 0; i < BINS_COUNT; i++) {
      const startIdx = i * intervalsPerBin;
      const endIdx = Math.min(startIdx + intervalsPerBin, BBJ_INTERVALS.length);
      
      if (startIdx >= BBJ_INTERVALS.length) break;
      
      const binIntervals = BBJ_INTERVALS.slice(startIdx, endIdx);
      const totalBBJs = binIntervals.reduce((sum, interval) => sum + interval.bbjCount, 0);
      
      bins.push({
        binIndex: i,
        bbjCount: totalBBJs,
        startInterval: binIntervals[0].interval,
        endInterval: binIntervals[binIntervals.length - 1].interval,
        startHand: binIntervals[0].startHand,
        endHand: binIntervals[binIntervals.length - 1].endHand,
      });
    }
    
    return bins;
  }, []);
  
  const maxBBJ = Math.max(...aggregatedBins.map(b => b.bbjCount));
  
  // True barcode: color intensity based on BBJ count (0=grey, more BBJs = brighter yellow)
  const getBarColor = (count: number): string => {
    if (count === 0) return '#3f3f46'; // zinc-700 grey
    if (count === 1) return '#a88b46'; // base gold
    if (count === 2) return '#b9994d'; // slightly brighter
    if (count === 3) return '#c9a854'; // brighter
    if (count === 4) return '#d9b65b'; // more bright
    if (count === 5) return '#e5c463'; // even brighter
    if (count === 6) return '#efd26b'; // bright yellow-gold
    if (count === 7) return '#f5dc73'; // brighter
    if (count >= 8) return '#fde047'; // bright yellow
    return '#fde047';
  };

  const hoveredData = hoveredBin !== null ? aggregatedBins[hoveredBin] : null;

  // Calculate stats from full dataset
  const totalBBJs = BBJ_INTERVALS.reduce((sum, i) => sum + i.bbjCount, 0);
  const intervalsWithBBJ = BBJ_INTERVALS.filter(i => i.bbjCount > 0).length;
  const totalHands = BBJ_INTERVALS[BBJ_INTERVALS.length - 1]?.endHand || 0;
  
  const longestDrought = useMemo(() => {
    let maxDrought = 0;
    let currentDrought = 0;
    for (const interval of BBJ_INTERVALS) {
      if (interval.bbjCount === 0) {
        currentDrought++;
        maxDrought = Math.max(maxDrought, currentDrought);
      } else {
        currentDrought = 0;
      }
    }
    return maxDrought;
  }, []);

  return (
    <div className="w-full mt-6">
      {/* Header */}
      <div className="flex flex-wrap justify-between items-center mb-2 text-[10px] text-zinc-500 gap-2">
        <span className="text-zinc-400 font-medium">BBJ Distribution Timeline</span>
        <div className="flex gap-4">
          <span>Hit rate: <span className="text-[#a88b46]">{((intervalsWithBBJ / BBJ_INTERVALS.length) * 100).toFixed(1)}%</span></span>
          <span>Max drought: <span className="text-zinc-400">{(longestDrought * 50000 / 1000000).toFixed(1)}M hands</span></span>
        </div>
      </div>
      
      {/* Barcode Container */}
      <div 
        ref={containerRef}
        className="relative w-full h-12 bg-zinc-900/30 rounded-lg overflow-hidden border border-zinc-800/50"
        onMouseLeave={() => setHoveredBin(null)}
      >
        {/* Bars - true barcode style: all full height, color varies */}
        <div className="flex h-full">
          {aggregatedBins.map((bin) => (
            <div
              key={bin.binIndex}
              className="flex-1 h-full cursor-pointer transition-opacity duration-75"
              onMouseEnter={() => setHoveredBin(bin.binIndex)}
              style={{
                backgroundColor: getBarColor(bin.bbjCount),
                opacity: hoveredBin === null ? 1 : hoveredBin === bin.binIndex ? 1 : 0.4,
              }}
            />
          ))}
        </div>
        
        {/* Tooltip - positioned above the bar */}
        {hoveredData && (
          <div 
            className="absolute z-50 pointer-events-none bg-zinc-950 border border-zinc-700 rounded-lg px-3 py-2 text-xs shadow-2xl"
            style={{ 
              left: `${Math.min(Math.max((hoveredBin || 0) / aggregatedBins.length * 100, 10), 85)}%`,
              bottom: '100%',
              marginBottom: '8px',
              transform: 'translateX(-50%)',
            }}
          >
            <div className="text-zinc-400 text-[11px] font-medium mb-1">
              {(hoveredData.startHand / 1000000).toFixed(1)}M – {(hoveredData.endHand / 1000000).toFixed(1)}M hands
            </div>
            <div className={`font-bold ${hoveredData.bbjCount > 0 ? 'text-[#a88b46]' : 'text-zinc-500'}`}>
              {hoveredData.bbjCount === 0 ? 'No BBJ' : `${hoveredData.bbjCount} BBJ${hoveredData.bbjCount > 1 ? 's' : ''}`}
            </div>
          </div>
        )}
      </div>
      
      {/* X-axis labels */}
      <div className="flex justify-between mt-1 text-[9px] text-zinc-600">
        <span>0</span>
        <span>45M</span>
        <span>89M</span>
        <span>134M</span>
        <span>178M hands</span>
      </div>
      
      {/* Legend */}
      <div className="flex justify-center items-center gap-1 mt-2">
        <span className="text-[9px] text-zinc-600 mr-1">0 BBJ</span>
        <div className="flex h-2 rounded-sm overflow-hidden">
          <div className="w-4 h-full" style={{ backgroundColor: '#3f3f46' }} />
          <div className="w-4 h-full" style={{ backgroundColor: '#a88b46' }} />
          <div className="w-4 h-full" style={{ backgroundColor: '#c9a854' }} />
          <div className="w-4 h-full" style={{ backgroundColor: '#e5c463' }} />
          <div className="w-4 h-full" style={{ backgroundColor: '#fde047' }} />
        </div>
        <span className="text-[9px] text-zinc-600 ml-1">8+ BBJ</span>
      </div>
    </div>
  );
};

// ============================================
// COMPONENT
// ============================================

const BBJDashboard: React.FC = () => {
  // ============================================
  // STATE
  // ============================================
  
  const [poolSize, setPoolSize] = useState<number>(2276000);
  const [selectedStake, setSelectedStake] = useState<string>('0.50/1');
  const [simulationHands, setSimulationHands] = useState<number>(1000000);
  const [numTrials, setNumTrials] = useState<number>(100);
  const [displayInDollars, setDisplayInDollars] = useState<boolean>(true);
  const [isCalculating, setIsCalculating] = useState<boolean>(false);
  const [varianceResult, setVarianceResult] = useState<VarianceResult | null>(null);
  const [simulationResults, setSimulationResults] = useState<SimulationResults | null>(null);
  const [simulationProgress, setSimulationProgress] = useState<number>(0);
  const [nachos, setNachos] = useState<any[]>([]);
  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
  const nachoRef = useRef<SVGSVGElement>(null);

  // ============================================
  // CALCULATION FUNCTIONS (UNCHANGED)
  // ============================================

  const calculateEV = (pool: number, stake: string = selectedStake): EVResult => {
    const stakeOption = STAKE_OPTIONS.find(s => s.value === stake) || STAKE_OPTIONS[4];
    const bbValue = stakeOption.bbValue;
    const avgTablePlayers = BBJ_CONSTANTS.avgPlayersPerTable;
    const otherPlayers = avgTablePlayers - 2;
    
    // New formula: Stake Fund = Pool × BB × coefficient
    const stakeFund = pool * bbValue * BBJ_CONSTANTS.stakeFundCoefficient;
    
    // Individual payouts from the Stake Fund
    const jackpotWinnerPayout = stakeFund * 0.10;  // 10% of Fund
    const opponentPayout = stakeFund * 0.03;       // 3% of Fund
    const tableSharePayout = stakeFund * 0.008;   // 0.8% of Fund per person
    const totalPayoutAtStake = stakeFund * 0.162; // 16.2% of Fund (10% + 3% + 4×0.8%)
    
    // Convert to BBs
    const jackpotWinnerBB = jackpotWinnerPayout / bbValue;
    const opponentBB = opponentPayout / bbValue;
    const tableShareBB = tableSharePayout / bbValue;
    
    // Convert to buy-ins: Prize / (BB × 100)
    const jackpotWinnerBuyins = jackpotWinnerPayout / (bbValue * 100);
    const opponentBuyins = opponentPayout / (bbValue * 100);
    const tableShareBuyins = tableSharePayout / (bbValue * 100);
    
    const expectedPayoutPerBBJ = 
      (1 / avgTablePlayers) * jackpotWinnerBB +
      (1 / avgTablePlayers) * opponentBB +
      (otherPlayers / avgTablePlayers) * tableShareBB;
    
    const payoutBB = totalPayoutAtStake / bbValue;
    const expectedPayoutPer100 = (100 / BBJ_CONSTANTS.handsPerBBJ) * expectedPayoutPerBBJ;
    const netBBper100 = expectedPayoutPer100 - BBJ_CONSTANTS.bbPer100Fees;
    const returnRatio = expectedPayoutPer100 / BBJ_CONSTANTS.bbPer100Fees;
    
    const isProfitable = netBBper100 >= 0;
    const percentToBreakeven = returnRatio * 100;
    
    const breakevenExpectedPerBBJ = BBJ_CONSTANTS.bbPer100Fees * BBJ_CONSTANTS.handsPerBBJ / 100;
    const currentExpectedPerBBJ = expectedPayoutPerBBJ;
    const poolMultiplier = breakevenExpectedPerBBJ / currentExpectedPerBBJ;
    const poolNeededForBreakeven = pool * poolMultiplier;
    
    return {
      payoutBB,
      returnRatio,
      netBBper100,
      isProfitable,
      percentToBreakeven,
      poolNeeded: poolNeededForBreakeven - pool,
      jackpotWinnerPayout,
      opponentPayout,
      tableSharePayout,
      totalPayoutAtStake,
      stakePoolSize: stakeFund, // Now represents the Stake Fund
    };
  };

  const calculateVariance = (hands: number, pool: number, stake: string = selectedStake): VarianceResult => {
    const stakeOption = STAKE_OPTIONS.find(s => s.value === stake) || STAKE_OPTIONS[4];
    const bbValue = stakeOption.bbValue;
    const lambda = hands / BBJ_CONSTANTS.handsPerBBJ;
    const totalFeesPaid = (hands / 100) * BBJ_CONSTANTS.bbPer100Fees;
    const avgTablePlayers = BBJ_CONSTANTS.avgPlayersPerTable;
    const otherPlayers = avgTablePlayers - 2;
    
    // New formula: Stake Fund = Pool × BB × coefficient
    const stakeFund = pool * bbValue * BBJ_CONSTANTS.stakeFundCoefficient;
    
    // Individual payouts in BBs
    const jackpotWinnerBB = (stakeFund * 0.10) / bbValue;
    const opponentBB = (stakeFund * 0.03) / bbValue;
    const tableShareBB = (stakeFund * 0.008) / bbValue;
    
    const expectedPayoutPerBBJ = 
      (1 / avgTablePlayers) * jackpotWinnerBB +
      (1 / avgTablePlayers) * opponentBB +
      (otherPlayers / avgTablePlayers) * tableShareBB;
    
    const expectedPayouts = lambda * expectedPayoutPerBBJ;
    const expectedProfit = expectedPayouts - totalFeesPaid;
    
    const varianceOfSingleBBJ = 
      (1 / avgTablePlayers) * Math.pow(jackpotWinnerBB - expectedPayoutPerBBJ, 2) +
      (1 / avgTablePlayers) * Math.pow(opponentBB - expectedPayoutPerBBJ, 2) +
      (otherPlayers / avgTablePlayers) * Math.pow(tableShareBB - expectedPayoutPerBBJ, 2);
    
    const totalVariance = lambda * varianceOfSingleBBJ + lambda * Math.pow(expectedPayoutPerBBJ, 2);
    const stdDeviation = Math.sqrt(totalVariance);
    
    const z95 = 1.96;
    const z99 = 2.576;
    
    const confidenceInterval95: [number, number] = [
      expectedProfit - z95 * stdDeviation,
      expectedProfit + z95 * stdDeviation
    ];
    
    const confidenceInterval99: [number, number] = [
      expectedProfit - z99 * stdDeviation,
      expectedProfit + z99 * stdDeviation
    ];
    
    const zScore = expectedProfit / (stdDeviation || 1);
    const probabilityOfProfit = 0.5 * (1 + erf(zScore / Math.sqrt(2)));
    
    const worstCase1Percent = expectedProfit - 2.326 * stdDeviation;
    const bestCase1Percent = expectedProfit + 2.326 * stdDeviation;
    
    return {
      expectedBBJs: lambda,
      expectedProfit,
      stdDeviation,
      confidenceInterval95,
      confidenceInterval99,
      probabilityOfProfit,
      totalFeesPaid,
      expectedPayouts,
      worstCase1Percent,
      bestCase1Percent,
    };
  };

  const erf = (x: number): number => {
    const a1 =  0.254829592;
    const a2 = -0.284496736;
    const a3 =  1.421413741;
    const a4 = -1.453152027;
    const a5 =  1.061405429;
    const p  =  0.3275911;

    const sign = x < 0 ? -1 : 1;
    x = Math.abs(x);

    const t = 1.0 / (1.0 + p * x);
    const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

    return sign * y;
  };

  const runSimulation = () => {
    setIsCalculating(true);
    setSimulationProgress(0);
    
    requestAnimationFrame(() => {
      const result = calculateVariance(simulationHands, poolSize, selectedStake);
      setVarianceResult(result);
      
      runMonteCarloSimulation();
    });
  };

  const runMonteCarloSimulation = useCallback(() => {
    const stakeOption = STAKE_OPTIONS.find(s => s.value === selectedStake) || STAKE_OPTIONS[4];
    const bbValue = stakeOption.bbValue;
    const avgTablePlayers = BBJ_CONSTANTS.avgPlayersPerTable;
    const otherPlayers = avgTablePlayers - 2;
    
    // New formula: Stake Fund = Pool × BB × coefficient
    const stakeFund = poolSize * bbValue * BBJ_CONSTANTS.stakeFundCoefficient;
    
    // Individual payouts in BBs
    const jackpotWinnerBB = (stakeFund * 0.10) / bbValue;
    const opponentBB = (stakeFund * 0.03) / bbValue;
    const tableShareBB = (stakeFund * 0.008) / bbValue;
    
    const bbjProbability = 1 / BBJ_CONSTANTS.handsPerBBJ;
    const feesPer100 = BBJ_CONSTANTS.bbPer100Fees;
    
    const trials: SimulationTrial[] = [];
    let currentTrial = 0;
    const batchSize = Math.max(1, Math.floor(numTrials / 20));
    
    const actualHandsPerTrial = simulationHands;
    const timelinePoints = 50;
    const handsPerPoint = Math.floor(actualHandsPerTrial / timelinePoints);
    
    const processBatch = () => {
      const batchEnd = Math.min(currentTrial + batchSize, numTrials);
      
      for (let t = currentTrial; t < batchEnd; t++) {
        let bbjsHit = 0;
        let jackpotWins = 0;
        let opponentWins = 0;
        let tableShares = 0;
        let totalPayout = 0;
        const timeline: { hands: number; profit: number; }[] = [];
        let runningProfit = 0;
        
        for (let point = 0; point < timelinePoints; point++) {
          const handsInSegment = handsPerPoint;
          const feesForSegment = (handsInSegment / 100) * feesPer100;
          runningProfit -= feesForSegment;
          
          for (let h = 0; h < handsInSegment; h++) {
            if (Math.random() < bbjProbability) {
              bbjsHit++;
              const role = Math.random() * avgTablePlayers;
              
              if (role < 1) {
                jackpotWins++;
                totalPayout += jackpotWinnerBB;
                runningProfit += jackpotWinnerBB;
              } else if (role < 2) {
                opponentWins++;
                totalPayout += opponentBB;
                runningProfit += opponentBB;
              } else {
                tableShares++;
                totalPayout += tableShareBB;
                runningProfit += tableShareBB;
              }
            }
          }
          
          timeline.push({
            hands: (point + 1) * handsPerPoint,
            profit: runningProfit
          });
        }
        
        const totalFeesPaid = (actualHandsPerTrial / 100) * feesPer100;
        
        trials.push({
          trialNumber: t + 1,
          bbjsHit,
          jackpotWins,
          opponentWins,
          tableShares,
          totalPayout,
          feesPaid: totalFeesPaid,
          netProfit: totalPayout - totalFeesPaid,
          timeline
        });
      }
      
      currentTrial = batchEnd;
      setSimulationProgress(Math.round((currentTrial / numTrials) * 100));
      
      if (currentTrial < numTrials) {
        requestAnimationFrame(processBatch);
      } else {
        const profits = trials.map(t => t.netProfit);
        profits.sort((a, b) => a - b);
        
        const sum = profits.reduce((a, b) => a + b, 0);
        const avg = sum / profits.length;
        const sortedProfits = [...profits].sort((a, b) => a - b);
        const median = sortedProfits[Math.floor(sortedProfits.length / 2)];
        const variance = profits.reduce((acc, p) => acc + Math.pow(p - avg, 2), 0) / profits.length;
        const stdDev = Math.sqrt(variance);
        const profitableCount = profits.filter(p => p >= 0).length;
        
        const twentyPercent = Math.max(1, Math.floor(sortedProfits.length * 0.2));
        const bottom20Profits = sortedProfits.slice(0, twentyPercent);
        const top20Profits = sortedProfits.slice(-twentyPercent);
        const bottom20Avg = bottom20Profits.reduce((a, b) => a + b, 0) / bottom20Profits.length;
        const top20Avg = top20Profits.reduce((a, b) => a + b, 0) / top20Profits.length;
        
        const bottom20BBper100 = (bottom20Avg / actualHandsPerTrial) * 100;
        const top20BBper100 = (top20Avg / actualHandsPerTrial) * 100;
        
        setSimulationResults({
          trials,
          averageProfit: avg,
          medianProfit: median,
          stdDev,
          minProfit: sortedProfits[0],
          maxProfit: sortedProfits[sortedProfits.length - 1],
          profitableTrials: profitableCount,
          totalTrials: numTrials,
          handsPerTrial: actualHandsPerTrial,
          bottom20BBper100,
          top20BBper100,
        });
        
        setIsCalculating(false);
      }
    };
    
    requestAnimationFrame(processBatch);
  }, [poolSize, selectedStake, simulationHands, numTrials]);

  // ============================================
  // MEMOIZED CALCULATIONS
  // ============================================

  const currentEV = useMemo(() => calculateEV(poolSize, selectedStake), [poolSize, selectedStake]);
  
  const evTableData = useMemo(() => {
    const poolSizes = [1800000, 2000000, 2200000, 2276000, 2400000, 2600000];
    return poolSizes.map(pool => ({
      pool,
      ...calculateEV(pool, selectedStake)
    }));
  }, [selectedStake]);

  // ============================================
  // NACHO MASCOT LOGIC
  // ============================================
  
  useEffect(() => {
    const handleMouseMove = (e: MouseEvent) => {
      setMousePos({ x: e.clientX, y: e.clientY });
    };
    window.addEventListener('mousemove', handleMouseMove);
    return () => window.removeEventListener('mousemove', handleMouseMove);
  }, []);

  const getEyeOffset = () => {
    if (!nachoRef.current) return { x: 0, y: 0 };
    const rect = nachoRef.current.getBoundingClientRect();
    const nachoCenter = {
      x: rect.left + rect.width / 2,
      y: rect.top + rect.height / 2
    };
    const angle = Math.atan2(mousePos.y - nachoCenter.y, mousePos.x - nachoCenter.x);
    const distance = Math.min(3, Math.hypot(mousePos.x - nachoCenter.x, mousePos.y - nachoCenter.y) / 50);
    return {
      x: Math.cos(angle) * distance,
      y: Math.sin(angle) * distance
    };
  };

  useEffect(() => {
    const newNachos = Array.from({ length: 14 }, (_, i) => ({
      id: i,
      x: Math.random() * 100,
      y: Math.random() * 100,
      size: 14 + Math.random() * 24,
      duration: 50 + Math.random() * 30,
      delay: Math.random() * 40,
      rotation: Math.random() * 360,
      opacity: 0.15 + Math.random() * 0.15,
      moveX: Math.random() * 80 - 40,
      moveY: Math.random() * 100 - 50
    }));
    setNachos(newNachos);
  }, []);

  const eyeOffset = getEyeOffset();

  // ============================================
  // HELPER COMPONENTS
  // ============================================

  const CartoonNacho = () => (
    <svg ref={nachoRef} width="90" height="90" viewBox="0 0 100 100" className="drop-shadow-[0_4px_12px_rgba(168,139,70,0.4)]">
      <path d="M50 8 L88 85 Q90 92 82 92 L18 92 Q10 92 12 85 Z" fill="#a88b46" stroke="#A68942" strokeWidth="2"/>
      <path d="M25 70 Q20 75 22 82 Q24 88 28 85 Q30 80 28 75 Z" fill="#E5C158" opacity="0.9"/>
      <path d="M72 65 Q78 72 76 80 Q74 86 70 82 Q68 76 70 70 Z" fill="#E5C158" opacity="0.9"/>
      <path d="M48 75 Q45 82 48 88 Q52 92 55 86 Q56 80 52 76 Z" fill="#E5C158" opacity="0.9"/>
      <ellipse cx="50" cy="50" rx="22" ry="18" fill="#a88b46" />
      <ellipse cx="40" cy="48" rx="8" ry="9" fill="white" />
      <ellipse cx="60" cy="48" rx="8" ry="9" fill="white" />
      <circle cx={40 + eyeOffset.x} cy={48 + eyeOffset.y} r="4" fill="#0a0a0a" className="transition-all duration-100"/>
      <circle cx={60 + eyeOffset.x} cy={48 + eyeOffset.y} r="4" fill="#0a0a0a" className="transition-all duration-100"/>
      <circle cx={38 + eyeOffset.x * 0.5} cy={46 + eyeOffset.y * 0.5} r="1.5" fill="white" opacity="0.8" />
      <circle cx={58 + eyeOffset.x * 0.5} cy={46 + eyeOffset.y * 0.5} r="1.5" fill="white" opacity="0.8" />
      <path d="M38 62 Q50 72 62 62" fill="none" stroke="#0a0a0a" strokeWidth="3" strokeLinecap="round"/>
      <path d="M33 38 Q40 35 47 38" fill="none" stroke="#0a0a0a" strokeWidth="2" strokeLinecap="round" />
      <path d="M53 38 Q60 35 67 38" fill="none" stroke="#0a0a0a" strokeWidth="2" strokeLinecap="round" />
    </svg>
  );

  const NachoTriangle = ({ size, opacity }: { size: number; opacity: number }) => (
    <svg width={size} height={size} viewBox="0 0 20 20" style={{ opacity }}>
      <path d="M10 2 L18 17 L2 17 Z" fill="#a88b46" opacity="0.6"/>
    </svg>
  );

  const formatCurrency = (value: number): string => {
    const absValue = Math.abs(value);
    const sign = value >= 0 ? '' : '-';
    
    if (absValue >= 1000000) {
      return `${sign}$${(absValue / 1000000).toFixed(2)}M`;
    }
    if (absValue >= 1000) {
      return `${sign}$${(absValue / 1000).toFixed(0)}K`;
    }
    return `${sign}$${absValue.toFixed(0)}`;
  };

  const formatBB = (value: number, showSign: boolean = false): string => {
    const sign = showSign ? (value >= 0 ? '+' : '') : '';
    if (Math.abs(value) >= 1000000) {
      return `${sign}${(value / 1000000).toFixed(2)}M bb`;
    }
    if (Math.abs(value) >= 1000) {
      return `${sign}${(value / 1000).toFixed(1)}K bb`;
    }
    return `${sign}${value.toFixed(1)} bb`;
  };

  const formatSimValue = (bbValue: number, showSign: boolean = false): string => {
    const stakeOption = STAKE_OPTIONS.find(s => s.value === selectedStake) || STAKE_OPTIONS[4];
    const dollarValue = bbValue * stakeOption.bbValue;
    
    if (displayInDollars) {
      const sign = showSign ? (dollarValue >= 0 ? '+' : '') : '';
      if (Math.abs(dollarValue) >= 1000000) {
        return `${sign}$${(dollarValue / 1000000).toFixed(2)}M`;
      }
      if (Math.abs(dollarValue) >= 1000) {
        return `${sign}$${(dollarValue / 1000).toFixed(1)}K`;
      }
      return `${sign}$${dollarValue.toFixed(2)}`;
    } else {
      const sign = showSign ? (bbValue >= 0 ? '+' : '') : '';
      if (Math.abs(bbValue) >= 1000000) {
        return `${sign}${(bbValue / 1000000).toFixed(2)}M bb`;
      }
      if (Math.abs(bbValue) >= 1000) {
        return `${sign}${(bbValue / 1000).toFixed(1)}K bb`;
      }
      return `${sign}${bbValue.toFixed(1)} bb`;
    }
  };

  const getEVColor = (value: number): string => {
    if (value > 0) return 'text-emerald-400';
    if (value < 0) return 'text-red-400';
    return 'text-zinc-400';
  };

  const getEVColorRaw = (value: number): string => {
    if (value > 0) return '#34d399';
    if (value < 0) return '#f87171';
    return '#a1a1aa';
  };

  // Line chart for simulation results
  const SimulationLineChart = ({ results }: { results: SimulationResults }) => {
    const chartWidth = 700;
    const chartHeight = 300;
    const padding = { top: 30, right: 60, bottom: 50, left: 80 };
    const innerWidth = chartWidth - padding.left - padding.right;
    const innerHeight = chartHeight - padding.top - padding.bottom;
    
    const stakeOption = STAKE_OPTIONS.find(s => s.value === selectedStake) || STAKE_OPTIONS[4];
    const bbValue = stakeOption.bbValue;
    
    const convertValue = (bb: number) => displayInDollars ? bb * bbValue : bb;
    
    const allProfits = results.trials.flatMap(t => t.timeline.map(p => convertValue(p.profit)));
    const minProfit = Math.min(...allProfits);
    const maxProfit = Math.max(...allProfits);
    const yRange = maxProfit - minProfit || 1;
    const yPadding = yRange * 0.1;
    const yMin = minProfit - yPadding;
    const yMax = maxProfit + yPadding;
    
    const maxHands = results.handsPerTrial;
    
    const scaleX = (hands: number) => padding.left + (hands / maxHands) * innerWidth;
    const scaleY = (profit: number) => padding.top + innerHeight - ((convertValue(profit) - yMin) / (yMax - yMin)) * innerHeight;
    
    const zeroY = padding.top + innerHeight - ((0 - yMin) / (yMax - yMin)) * innerHeight;
    
    const visibleTrials = results.trials;
    
    const getLineColor = (index: number, profit: number) => {
      if (profit >= 0) return `hsla(142, 70%, ${50 + (index % 3) * 10}%, 0.6)`;
      return `hsla(0, 70%, ${50 + (index % 3) * 10}%, 0.6)`;
    };
    
    const formatAxisLabel = (value: number) => {
      if (Math.abs(value) >= 1000000000) return `${(value / 1000000000).toFixed(0)}B`;
      if (Math.abs(value) >= 1000000) return `${(value / 1000000).toFixed(0)}M`;
      if (Math.abs(value) >= 1000) return `${(value / 1000).toFixed(0)}K`;
      return value.toFixed(0);
    };
    
    const formatYAxisLabel = (value: number) => {
      const formatted = formatAxisLabel(value);
      return displayInDollars ? `$${formatted}` : `${formatted} bb`;
    };

    return (
      <div className="w-full overflow-x-auto">
        <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full min-w-[600px]">
          {/* Grid lines */}
          {[0.25, 0.5, 0.75].map(pct => (
            <line 
              key={pct}
              x1={padding.left} 
              y1={padding.top + innerHeight * pct} 
              x2={padding.left + innerWidth} 
              y2={padding.top + innerHeight * pct} 
              stroke="rgba(255,255,255,0.05)" 
              strokeDasharray="4"
            />
          ))}
          
          {/* Zero line */}
          {yMin < 0 && yMax > 0 && (
            <line 
              x1={padding.left} 
              y1={zeroY} 
              x2={padding.left + innerWidth} 
              y2={zeroY} 
              stroke="rgba(212, 175, 55, 0.3)" 
              strokeWidth="1"
            />
          )}
          
          {/* Trial lines */}
          {visibleTrials.map((trial, idx) => {
            const points = trial.timeline.map(p => `${scaleX(p.hands)},${scaleY(p.profit)}`).join(' ');
            return (
              <polyline
                key={trial.trialNumber}
                points={points}
                fill="none"
                stroke={getLineColor(idx, trial.netProfit)}
                strokeWidth="1.5"
                strokeLinejoin="round"
              />
            );
          })}
          
          {/* Average line */}
          {(() => {
            const avgTimeline = Array.from({ length: visibleTrials[0]?.timeline.length || 0 }, (_, i) => {
              const avgProfit = visibleTrials.reduce((sum, t) => sum + t.timeline[i].profit, 0) / visibleTrials.length;
              return { hands: visibleTrials[0]?.timeline[i].hands || 0, profit: avgProfit };
            });
            const points = avgTimeline.map(p => `${scaleX(p.hands)},${scaleY(p.profit)}`).join(' ');
            return (
              <polyline
                points={points}
                fill="none"
                stroke="#a88b46"
                strokeWidth="3"
                strokeLinejoin="round"
                opacity="0.9"
              />
            );
          })()}
          
          {/* X axis */}
          <line 
            x1={padding.left} 
            y1={padding.top + innerHeight} 
            x2={padding.left + innerWidth} 
            y2={padding.top + innerHeight} 
            stroke="rgba(255,255,255,0.3)" 
          />
          
          {/* X axis labels */}
          <text x={padding.left} y={chartHeight - 15} fill="rgba(255,255,255,0.5)" fontSize="11" textAnchor="start">
            0
          </text>
          <text x={padding.left + innerWidth / 2} y={chartHeight - 15} fill="rgba(255,255,255,0.5)" fontSize="11" textAnchor="middle">
            {formatAxisLabel(maxHands / 2)} hands
          </text>
          <text x={padding.left + innerWidth} y={chartHeight - 15} fill="rgba(255,255,255,0.5)" fontSize="11" textAnchor="end">
            {formatAxisLabel(maxHands)}
          </text>
          <text x={padding.left + innerWidth / 2} y={chartHeight - 2} fill="rgba(255,255,255,0.4)" fontSize="10" textAnchor="middle">
            Hands Played
          </text>
          
          {/* Y axis */}
          <line 
            x1={padding.left} 
            y1={padding.top} 
            x2={padding.left} 
            y2={padding.top + innerHeight} 
            stroke="rgba(255,255,255,0.3)" 
          />
          
          {/* Y axis labels */}
          <text x={padding.left - 10} y={padding.top + 4} fill="rgba(255,255,255,0.5)" fontSize="11" textAnchor="end">
            {formatYAxisLabel(yMax)}
          </text>
          {yMin < 0 && yMax > 0 && (
            <text x={padding.left - 10} y={zeroY + 4} fill="rgba(255,255,255,0.7)" fontSize="11" textAnchor="end" fontWeight="600">
              0
            </text>
          )}
          <text x={padding.left - 10} y={padding.top + innerHeight + 4} fill="rgba(255,255,255,0.5)" fontSize="11" textAnchor="end">
            {formatYAxisLabel(yMin)}
          </text>
          
          {/* Y axis title */}
          <text 
            x={15} 
            y={padding.top + innerHeight / 2} 
            fill="rgba(255,255,255,0.4)" 
            fontSize="10" 
            textAnchor="middle"
            transform={`rotate(-90, 15, ${padding.top + innerHeight / 2})`}
          >
            Profit ({displayInDollars ? '$' : 'bb'})
          </text>
          
          {/* Legend */}
          <g transform={`translate(${padding.left + innerWidth - 120}, ${padding.top + 10})`}>
            <rect x="-5" y="-5" width="130" height="50" fill="rgba(0,0,0,0.5)" rx="4" />
            <line x1="0" y1="8" x2="25" y2="8" stroke="#a88b46" strokeWidth="3" />
            <text x="30" y="12" fill="rgba(255,255,255,0.7)" fontSize="10">Average</text>
            <line x1="0" y1="25" x2="25" y2="25" stroke="rgba(34, 197, 94, 0.6)" strokeWidth="1.5" />
            <text x="30" y="29" fill="rgba(255,255,255,0.7)" fontSize="10">Winning Trial</text>
            <line x1="0" y1="42" x2="25" y2="42" stroke="rgba(239, 68, 68, 0.6)" strokeWidth="1.5" />
            <text x="30" y="46" fill="rgba(255,255,255,0.7)" fontSize="10">Losing Trial</text>
          </g>
        </svg>
      </div>
    );
  };

  // ============================================
  // RENDER
  // ============================================

  return (
    <div className="min-h-screen bg-[#0A0A0A] relative overflow-hidden font-['Inter',_-apple-system,_BlinkMacSystemFont,_sans-serif]">
      {/* Noise/Grain Texture Overlay */}
      <div 
        className="noise-overlay"
        style={{
          position: 'fixed',
          top: 0,
          left: 0,
          width: '100%',
          height: '100%',
          pointerEvents: 'none',
          zIndex: 9999,
          opacity: 0.03
        }}
      />

      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@400;500;600;700;800&display=swap');
        
        .noise-overlay {
          background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Gold Sparkborder Effect */
        @keyframes traceBorder { 0% { offset-distance: 0%; } 100% { offset-distance: 100%; } }
        
        .spark-border-gold { 
          position: relative; 
          overflow: hidden; 
          border-radius: 24px; 
          background: rgba(18, 18, 18, 0.6);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
        }
        .spark-border-gold::before { 
          content: ""; 
          position: absolute; 
          inset: 0; 
          border-radius: inherit; 
          padding: 1px; 
          background: linear-gradient(135deg, rgba(168, 139, 70, 0.5), rgba(168, 139, 70, 0.15)); 
          -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); 
          -webkit-mask-composite: xor; 
          mask-composite: exclude; 
          z-index: 1; 
          pointer-events: none; 
        }
        .spark-border-gold::after { 
          content: ""; 
          position: absolute; 
          top: 0; 
          left: 0; 
          width: 80px; 
          height: 2px; 
          background: linear-gradient(90deg, transparent 0%, #a88b46 50%, #a88b46 100%); 
          box-shadow: 0 0 15px 2px rgba(168, 139, 70, 0.6); 
          offset-path: rect(0 100% 100% 0 round 24px); 
          animation: traceBorder 6s linear infinite; 
          z-index: 2; 
          pointer-events: none; 
        }

        /* === DEPTH-OF-FIELD BOKEH ANIMATIONS === */
        @keyframes peripheralWobble1 {
          0% { transform: translate(0, 0) rotate(0deg) scale(1); }
          15% { transform: translate(3px, -5px) rotate(2deg) scale(1.01); }
          30% { transform: translate(6px, -3px) rotate(4deg) scale(0.99); }
          45% { transform: translate(4px, -8px) rotate(6deg) scale(1.02); }
          60% { transform: translate(2px, -4px) rotate(3deg) scale(0.98); }
          75% { transform: translate(5px, -6px) rotate(5deg) scale(1.01); }
          90% { transform: translate(1px, -2px) rotate(1deg) scale(1); }
          100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        @keyframes peripheralWobble2 {
          0% { transform: translate(0, 0) rotate(0deg) scale(1); }
          20% { transform: translate(-4px, -6px) rotate(-3deg) scale(1.02); }
          40% { transform: translate(-2px, -10px) rotate(-5deg) scale(0.98); }
          60% { transform: translate(-6px, -4px) rotate(-2deg) scale(1.01); }
          80% { transform: translate(-3px, -7px) rotate(-4deg) scale(0.99); }
          100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        @keyframes foregroundDrift1 {
          0% { transform: translate(0, 0) rotate(0deg) scale(1); }
          20% { transform: translate(8px, -12px) rotate(8deg) scale(1.02); }
          40% { transform: translate(15px, -8px) rotate(15deg) scale(0.98); }
          60% { transform: translate(10px, -18px) rotate(22deg) scale(1.01); }
          80% { transform: translate(5px, -5px) rotate(12deg) scale(0.99); }
          100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        @keyframes foregroundDrift2 {
          0% { transform: translate(0, 0) rotate(0deg) scale(1); }
          25% { transform: translate(-10px, -15px) rotate(-12deg) scale(1.03); }
          50% { transform: translate(-5px, -25px) rotate(-20deg) scale(0.97); }
          75% { transform: translate(-12px, -10px) rotate(-8deg) scale(1.02); }
          100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        @keyframes foregroundDrift3 {
          0% { transform: translate(0, 0) rotate(0deg) scale(1); }
          30% { transform: translate(12px, -20px) rotate(18deg) scale(0.98); }
          60% { transform: translate(6px, -10px) rotate(10deg) scale(1.02); }
          100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        @keyframes midgroundDrift1 {
          0% { transform: translate(0, 0) rotate(0deg); }
          20% { transform: translate(20px, -30px) rotate(25deg); }
          40% { transform: translate(35px, -20px) rotate(50deg); }
          60% { transform: translate(25px, -40px) rotate(75deg); }
          80% { transform: translate(10px, -15px) rotate(55deg); }
          100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes midgroundDrift2 {
          0% { transform: translate(0, 0) rotate(0deg); }
          25% { transform: translate(-25px, -35px) rotate(-40deg); }
          50% { transform: translate(-15px, -50px) rotate(-80deg); }
          75% { transform: translate(-30px, -25px) rotate(-50deg); }
          100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes midgroundDrift3 {
          0% { transform: translate(0, 0) rotate(0deg); }
          33% { transform: translate(30px, -25px) rotate(60deg); }
          66% { transform: translate(15px, -45px) rotate(120deg); }
          100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes backgroundDart1 {
          0% { transform: translate(0, 0) rotate(0deg); }
          10% { transform: translate(25px, -40px) rotate(45deg); }
          25% { transform: translate(50px, -25px) rotate(90deg); }
          40% { transform: translate(35px, -60px) rotate(150deg); }
          55% { transform: translate(60px, -35px) rotate(200deg); }
          70% { transform: translate(40px, -55px) rotate(270deg); }
          85% { transform: translate(20px, -30px) rotate(320deg); }
          100% { transform: translate(0, 0) rotate(360deg); }
        }
        @keyframes backgroundDart2 {
          0% { transform: translate(0, 0) rotate(0deg); }
          15% { transform: translate(-35px, -50px) rotate(-60deg); }
          30% { transform: translate(-20px, -30px) rotate(-120deg); }
          50% { transform: translate(-50px, -45px) rotate(-180deg); }
          70% { transform: translate(-30px, -60px) rotate(-250deg); }
          85% { transform: translate(-15px, -25px) rotate(-310deg); }
          100% { transform: translate(0, 0) rotate(-360deg); }
        }
      `}</style>

      {/* ==================== BACKGROUND GLOWS ==================== */}
      <div style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none', zIndex: 0, overflow: 'hidden' }}>
        <div style={{ position: 'absolute', top: '-10%', right: '-8%', width: '900px', height: '900px', borderRadius: '50%', background: 'radial-gradient(circle, rgba(168, 139, 70, 0.08) 0%, transparent 60%)', filter: 'blur(80px)', opacity: 0.6 }} />
        <div style={{ position: 'absolute', bottom: '-15%', left: '-12%', width: '1000px', height: '1000px', borderRadius: '50%', background: 'radial-gradient(circle, rgba(168, 139, 70, 0.06) 0%, transparent 55%)', filter: 'blur(100px)', opacity: 0.5 }} />
        <div style={{ position: 'absolute', top: '40%', right: '5%', width: '600px', height: '600px', borderRadius: '50%', background: 'radial-gradient(circle, rgba(168, 139, 70, 0.05) 0%, transparent 50%)', filter: 'blur(60px)', opacity: 0.4 }} />
      </div>

      {/* ==================== PERIPHERAL BOKEH NACHOS ==================== */}
      <div style={{ position: 'fixed', inset: 0, pointerEvents: 'none', zIndex: 0, overflow: 'hidden' }}>
        <div style={{ position: 'absolute', top: '5%', left: '-8%', width: '180px', height: '180px', opacity: 0.06, filter: 'blur(18px)', animation: 'peripheralWobble1 120s ease-in-out infinite' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '40%', left: '-12%', width: '220px', height: '220px', opacity: 0.05, filter: 'blur(22px)', animation: 'peripheralWobble2 140s ease-in-out infinite', animationDelay: '-40s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '10%', left: '-6%', width: '160px', height: '160px', opacity: 0.07, filter: 'blur(16px)', animation: 'peripheralWobble1 100s ease-in-out infinite', animationDelay: '-70s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '8%', right: '-10%', width: '200px', height: '200px', opacity: 0.05, filter: 'blur(20px)', animation: 'peripheralWobble2 130s ease-in-out infinite', animationDelay: '-20s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '50%', right: '-14%', width: '240px', height: '240px', opacity: 0.04, filter: 'blur(24px)', animation: 'peripheralWobble1 150s ease-in-out infinite', animationDelay: '-60s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '15%', right: '-8%', width: '170px', height: '170px', opacity: 0.06, filter: 'blur(17px)', animation: 'peripheralWobble2 110s ease-in-out infinite', animationDelay: '-90s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
      </div>

      {/* ==================== FOREGROUND BOKEH NACHOS ==================== */}
      <div style={{ position: 'fixed', inset: 0, pointerEvents: 'none', zIndex: 1, overflow: 'hidden' }}>
        <div style={{ position: 'absolute', top: '5%', left: '3%', width: '90px', height: '90px', opacity: 0.12, filter: 'blur(12px)', animation: 'foregroundDrift1 80s ease-in-out infinite' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '10%', right: '5%', width: '110px', height: '110px', opacity: 0.10, filter: 'blur(14px)', animation: 'foregroundDrift2 90s ease-in-out infinite', animationDelay: '-30s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '45%', left: '-2%', width: '80px', height: '80px', opacity: 0.08, filter: 'blur(10px)', animation: 'foregroundDrift3 70s ease-in-out infinite', animationDelay: '-45s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '15%', right: '8%', width: '70px', height: '70px', opacity: 0.09, filter: 'blur(11px)', animation: 'foregroundDrift1 85s ease-in-out infinite', animationDelay: '-60s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
      </div>

      {/* ==================== MIDGROUND BOKEH NACHOS ==================== */}
      <div style={{ position: 'fixed', inset: 0, pointerEvents: 'none', zIndex: 2, overflow: 'hidden' }}>
        <div style={{ position: 'absolute', top: '20%', left: '15%', width: '40px', height: '40px', opacity: 0.18, filter: 'blur(4px)', animation: 'midgroundDrift1 45s ease-in-out infinite' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '60%', right: '20%', width: '35px', height: '35px', opacity: 0.16, filter: 'blur(5px)', animation: 'midgroundDrift2 50s ease-in-out infinite', animationDelay: '-15s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '30%', left: '8%', width: '45px', height: '45px', opacity: 0.15, filter: 'blur(4px)', animation: 'midgroundDrift3 55s ease-in-out infinite', animationDelay: '-25s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '35%', right: '12%', width: '38px', height: '38px', opacity: 0.14, filter: 'blur(3px)', animation: 'midgroundDrift1 48s ease-in-out infinite', animationDelay: '-35s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '75%', left: '25%', width: '32px', height: '32px', opacity: 0.17, filter: 'blur(4px)', animation: 'midgroundDrift2 42s ease-in-out infinite', animationDelay: '-40s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '10%', left: '55%', width: '42px', height: '42px', opacity: 0.13, filter: 'blur(4px)', animation: 'midgroundDrift3 52s ease-in-out infinite', animationDelay: '-50s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
      </div>

      {/* ==================== BACKGROUND (FOCAL) BOKEH NACHOS ==================== */}
      <div style={{ position: 'fixed', inset: 0, pointerEvents: 'none', zIndex: 3, overflow: 'hidden' }}>
        <div style={{ position: 'absolute', top: '25%', left: '20%', width: '18px', height: '18px', opacity: 0.35, filter: 'blur(0.5px)', animation: 'backgroundDart1 25s linear infinite' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '55%', right: '25%', width: '15px', height: '15px', opacity: 0.30, filter: 'blur(0.5px)', animation: 'backgroundDart2 28s linear infinite', animationDelay: '-8s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '35%', left: '35%', width: '20px', height: '20px', opacity: 0.28, filter: 'blur(0.5px)', animation: 'backgroundDart1 22s linear infinite', animationDelay: '-12s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '40%', right: '35%', width: '16px', height: '16px', opacity: 0.32, filter: 'blur(0.5px)', animation: 'backgroundDart2 30s linear infinite', animationDelay: '-18s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', top: '15%', left: '45%', width: '14px', height: '14px', opacity: 0.25, filter: 'blur(0.5px)', animation: 'backgroundDart1 26s linear infinite', animationDelay: '-5s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
        <div style={{ position: 'absolute', bottom: '20%', right: '40%', width: '17px', height: '17px', opacity: 0.27, filter: 'blur(0.5px)', animation: 'backgroundDart2 24s linear infinite', animationDelay: '-15s' }}>
          <svg viewBox="0 0 100 100" style={{ width: '100%', height: '100%' }}><polygon points="50,5 95,95 5,95" fill="#a88b46" /></svg>
        </div>
      </div>

      {/* Main Content */}
      <div className="relative z-10 max-w-6xl mx-auto px-5 py-6">
        <NachosPokerNavBar />
        
        {/* ==================== HERO CTA BAR WITH SPARKBORDER ==================== */}
        <div className="spark-border-gold mb-8 p-8 md:p-10">
          <div className="relative flex items-center gap-8 flex-wrap">
            <div className="flex-1 min-w-[280px]">
              <h2 style={{
                fontSize: 'clamp(28px, 4vw, 36px)', 
                fontWeight: 800, 
                color: '#FFFFFF', 
                marginBottom: '12px', 
                lineHeight: 1.1,
                letterSpacing: '-0.02em',
                fontFamily: 'Manrope, Inter, sans-serif'
              }}>
                BBJ <span style={{ color: '#a88b46' }}>Calculator</span>
              </h2>
              <p style={{ fontSize: '15px', color: 'rgba(255,255,255,0.55)', marginBottom: 0, lineHeight: 1.6 }}>
                Understand the true impact of jackpot structures on your long-term EV as a grinder on GGPoker. If you'd rather win by skill than by a clerical error in the deck, let's get to work together!
              </p>
            </div>
            
            <div className="flex gap-3 flex-shrink-0 flex-wrap">
              <a 
                href="/"
                className="hover:-translate-y-0.5 transition-all duration-300"
                style={{
                  background: '#a88b46',
                  color: '#0a0a0a',
                  padding: '14px 24px',
                  borderRadius: '12px',
                  fontWeight: 600,
                  fontSize: '14px',
                  textDecoration: 'none',
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '8px',
                  boxShadow: '0 4px 20px rgba(168, 139, 70, 0.3)'
                }}
              >
                <GraduationCap size={16} /> Mentorship Program
              </a>
              <a 
                href="https://www.nachospoker.com" 
                target="_blank" 
                rel="noopener noreferrer"
                className="hover:-translate-y-0.5 transition-all duration-300"
                style={{
                  background: 'transparent',
                  border: '1.5px solid #a88b46',
                  color: '#a88b46',
                  padding: '14px 24px',
                  borderRadius: '12px',
                  fontWeight: 600,
                  fontSize: '14px',
                  textDecoration: 'none',
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
              >
                Join the CFP <ExternalLink size={14} />
              </a>
            </div>
          </div>
        </div>

        {/* Data Methodology Section */}
        <motion.div 
          className="rounded-3xl p-6 md:p-8 mb-8 bg-white/[0.02] backdrop-blur-xl border border-white/10"
          variants={fadeInUp}
          initial="hidden"
          animate="visible"
          transition={{ delay: 0.1 }}
        >
          <div className="flex items-start gap-4">
            <div className="flex-shrink-0 bg-[#a88b46]/15 rounded-2xl p-3">
              <Database size={24} className="text-[#a88b46]" />
            </div>
            <div className="flex-1">
              <h3 className="text-white text-lg font-bold mb-3">About This Data</h3>
              
              <p className="text-zinc-400 text-sm leading-relaxed mb-3">
                Based on <strong className="text-[#a88b46]">178.6 million hands</strong> from GGPoker NL100+. 
                We found <strong className="text-[#a88b46]">1,952 BBJ triggers</strong> , a frequency of <strong>1 in 91,500 hands</strong>.
              </p>
              
              <p className="text-zinc-500 text-xs leading-relaxed mb-5">
                Sample: 144.7M regular hands + 33.9M Rush & Cash. Rush plays faster (new table each hand) but BBJ rules are identical , combining both ensures robust data.
              </p>
              
              {/* Key Numbers */}
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div className="bg-red-500/10 border border-red-500/20 rounded-2xl p-4 text-center">
                  <div className="text-[11px] text-zinc-500 mb-1.5 uppercase tracking-wide">Your Jackpot "Rake"</div>
                  <div className="text-2xl md:text-3xl text-red-400 font-bold">1.83 bb/100</div>
                </div>
                <div className="bg-[#a88b46]/10 border border-[#a88b46]/20 rounded-2xl p-4 text-center">
                  <div className="text-[11px] text-zinc-500 mb-1.5 uppercase tracking-wide">Break-Even Pool</div>
                  <div className="text-2xl md:text-3xl text-[#a88b46] font-bold">~$2.28M</div>
                </div>
              </div>

              {/* BBJ Probability Grid */}
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-2 mt-6">
                <div className="bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-xl p-3 text-center">
                  <div className="text-base mb-1">🏆</div>
                  <div className="text-[10px] text-zinc-500 uppercase tracking-wide mb-0.5">Win Jackpot</div>
                  <div className="text-sm font-bold text-[#a88b46]">1 in {PROBABILITY_DATA.handsToWinJackpot.toLocaleString()}</div>
                </div>
                <div className="bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-xl p-3 text-center">
                  <div className="text-base mb-1">🥈</div>
                  <div className="text-[10px] text-zinc-500 uppercase tracking-wide mb-0.5">Opponent Win</div>
                  <div className="text-sm font-bold text-[#a88b46]">1 in {PROBABILITY_DATA.handsToBeOpponent.toLocaleString()}</div>
                </div>
                <div className="bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-xl p-3 text-center">
                  <div className="text-base mb-1">🎫</div>
                  <div className="text-[10px] text-zinc-500 uppercase tracking-wide mb-0.5">Table Share</div>
                  <div className="text-sm font-bold text-[#a88b46]">1 in {PROBABILITY_DATA.handsToGetTableShare.toLocaleString()}</div>
                </div>
                <div className="bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-xl p-3 text-center">
                  <div className="text-base mb-1">👀</div>
                  <div className="text-[10px] text-zinc-500 uppercase tracking-wide mb-0.5">Witness Any BBJ</div>
                  <div className="text-sm font-bold text-[#a88b46]">1 in {PROBABILITY_DATA.handsToSeeOneBBJ.toLocaleString()}</div>
                </div>
              </div>

              {/* BBJ Distribution Barcode */}
              <BBJBarcodeGraph />
            </div>
          </div>
        </motion.div>

        {/* Variance Simulator Section */}
        <motion.div 
          className="rounded-3xl p-6 md:p-10 mb-8 bg-white/[0.03] backdrop-blur-xl border border-white/10"
          variants={fadeInUp}
          initial="hidden"
          animate="visible"
          transition={{ delay: 0.15 }}
        >
          <div className="flex items-center justify-center gap-3 mb-2">
            <Calculator size={28} className="text-[#a88b46]" />
            <h2 className="text-xl md:text-2xl font-bold text-white">Variance Simulator</h2>
          </div>
          <p className="text-center text-zinc-500 text-sm mb-8 max-w-3xl mx-auto">
            See how the -1.83bb/100 jackpot fee impacts your bankroll over thousands of trials. At a pool size of roughly $2,276,000, the mathematical frequency of hitting the BBJ should offset the fee and brings your theoretical EV back to zero.
          </p>

          {/* Simulator Controls */}
          <motion.div 
            className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"
            variants={staggerContainer}
            initial="hidden"
            animate="visible"
          >
            {/* Hands per Trial */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-3 text-xs font-semibold uppercase tracking-wider">
                Hands per Trial
              </h3>
              <div className="grid grid-cols-2 gap-2">
                {[100000, 1000000, 10000000, 100000000].map(preset => (
                  <button
                    key={preset}
                    onClick={() => setSimulationHands(preset)}
                    className={`py-2 px-3 rounded-lg text-xs font-semibold transition-all duration-200 ${
                      simulationHands === preset 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 hover:text-white border border-zinc-700'
                    }`}
                  >
                    {preset >= 1000000 ? `${preset / 1000000}M` : `${preset / 1000}K`}
                  </button>
                ))}
              </div>
            </motion.div>

            {/* Number of Trials */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-3 text-xs font-semibold uppercase tracking-wider">
                Number of Trials
              </h3>
              <div className="grid grid-cols-2 gap-2">
                {[10, 20, 50, 100].map(preset => (
                  <button
                    key={preset}
                    onClick={() => setNumTrials(preset)}
                    className={`py-2 px-3 rounded-lg text-xs font-semibold transition-all duration-200 ${
                      numTrials === preset 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 hover:text-white border border-zinc-700'
                    }`}
                  >
                    {preset}
                  </button>
                ))}
              </div>
            </motion.div>

            {/* Your Stakes */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-3 text-xs font-semibold uppercase tracking-wider">
                Your Stakes
              </h3>
              <div className="grid grid-cols-2 gap-1">
                {STAKE_OPTIONS.slice(0, 6).map(stake => (
                  <button
                    key={stake.value}
                    onClick={() => setSelectedStake(stake.value)}
                    className={`py-1.5 px-2 rounded-md text-[10px] font-semibold transition-all duration-200 ${
                      selectedStake === stake.value 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 hover:text-white border border-zinc-700'
                    }`}
                  >
                    {stake.label.replace('$', '')}
                  </button>
                ))}
              </div>
            </motion.div>

            {/* BBJ Pool Size */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-3 text-xs font-semibold uppercase tracking-wider">
                BBJ Pool Size
              </h3>
              <input
                type="number"
                className="w-full bg-zinc-800/50 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm mb-2 focus:border-[#a88b46] focus:ring-1 focus:ring-[#a88b46]/30 outline-none transition-all"
                value={poolSize}
                onChange={(e) => setPoolSize(parseFloat(e.target.value) || 0)}
              />
              <div className="grid grid-cols-2 gap-1">
                {[1800000, 2200000, 2400000].map(preset => (
                  <button
                    key={preset}
                    onClick={() => setPoolSize(preset)}
                    className={`py-1 px-2 rounded-md text-[9px] font-semibold transition-all duration-200 ${
                      poolSize === preset 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 border border-zinc-700'
                    }`}
                  >
                    ${(preset / 1000000).toFixed(1)}M
                  </button>
                ))}
                <button
                  onClick={() => setPoolSize(2276000)}
                  className={`py-1 px-2 rounded-md text-[9px] font-bold transition-all duration-200 ${
                    poolSize === 2276000 
                      ? 'bg-[#a88b46] text-zinc-950' 
                      : 'bg-[#a88b46]/20 text-[#a88b46] hover:bg-[#a88b46]/30 border border-[#a88b46]/30'
                  }`}
                >
                  Break-even
                </button>
              </div>
            </motion.div>
          </motion.div>

          {/* Run Simulation Button */}
          <div className="text-center mb-8">
            <motion.button
              onClick={runSimulation}
              disabled={isCalculating}
              className={`px-12 py-4 rounded-2xl font-bold text-base inline-flex items-center gap-3 transition-all duration-300 ${
                isCalculating 
                  ? 'bg-[#a88b46]/30 text-zinc-600 cursor-not-allowed' 
                  : 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950 hover:shadow-[0_0_30px_rgba(168,139,70,0.4)] hover:-translate-y-1'
              }`}
              whileTap={{ scale: isCalculating ? 1 : 0.98 }}
            >
              {isCalculating ? (
                <>
                  <RefreshCw size={20} className="animate-spin" />
                  Simulating... {simulationProgress}%
                </>
              ) : (
                <>
                  <Play size={20} />
                  Run {numTrials} Simulations
                </>
              )}
            </motion.button>
            
            {isCalculating && (
              <motion.div 
                className="mt-4 max-w-md mx-auto"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
              >
                <div className="w-full h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                  <motion.div 
                    className="h-full bg-gradient-to-r from-[#a88b46] to-emerald-500 rounded-full"
                    initial={{ width: 0 }}
                    animate={{ width: `${simulationProgress}%` }}
                    transition={{ duration: 0.3 }}
                  />
                </div>
              </motion.div>
            )}
          </div>

          {/* Simulation Results */}
          {simulationResults && !isCalculating && (
            <motion.div
              variants={fadeIn}
              initial="hidden"
              animate="visible"
            >
              <h3 className="text-white text-lg font-semibold mb-4 text-center flex items-center justify-center gap-3">
                <BarChart3 size={20} className="text-[#a88b46]" />
                Results: {simulationResults.totalTrials} simulations of {simulationResults.handsPerTrial >= 1000000 ? `${(simulationResults.handsPerTrial / 1000000)}M` : `${(simulationResults.handsPerTrial / 1000)}K`} hands each
              </h3>
              
              {/* Display Toggle */}
              <div className="flex justify-center mb-6">
                <div className="inline-flex rounded-xl overflow-hidden border border-zinc-700">
                  <button
                    onClick={() => setDisplayInDollars(false)}
                    className={`px-5 py-2 text-xs font-semibold transition-all duration-200 ${
                      !displayInDollars 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:text-white'
                    }`}
                  >
                    Show in BB
                  </button>
                  <button
                    onClick={() => setDisplayInDollars(true)}
                    className={`px-5 py-2 text-xs font-semibold transition-all duration-200 ${
                      displayInDollars 
                        ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                        : 'bg-zinc-800/50 text-zinc-400 hover:text-white'
                    }`}
                  >
                    Show in $
                  </button>
                </div>
              </div>

              {/* Line Chart */}
              <div className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-6 mb-6">
                <h4 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider flex items-center gap-2">
                  <LineChart size={16} /> Bankroll Over Time ({simulationResults.totalTrials} trials shown)
                </h4>
                <SimulationLineChart results={simulationResults} />
                <div className="mt-3 text-center text-[11px] text-zinc-500">
                  Lines trend down from fees ({BBJ_CONSTANTS.bbPer100Fees.toFixed(2)} bb/100), jump up when BBJ hits
                </div>
              </div>

              {/* Summary Statistics */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <motion.div 
                  className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
                  variants={scaleIn}
                >
                  <div className="text-[11px] text-zinc-500 mb-2 uppercase tracking-wide">Average BB/100</div>
                  <div className={`text-2xl font-bold ${getEVColor(simulationResults.averageProfit)}`}>
                    {((simulationResults.averageProfit / simulationResults.handsPerTrial) * 100) >= 0 ? '+' : ''}{((simulationResults.averageProfit / simulationResults.handsPerTrial) * 100).toFixed(4)}
                  </div>
                  <div className="text-[11px] text-zinc-600 mt-1">across all {simulationResults.totalTrials} trials</div>
                </motion.div>

                <motion.div 
                  className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
                  variants={scaleIn}
                >
                  <div className="text-[11px] text-zinc-500 mb-2 uppercase tracking-wide">Median BB/100</div>
                  <div className={`text-2xl font-bold ${getEVColor(simulationResults.medianProfit)}`}>
                    {((simulationResults.medianProfit / simulationResults.handsPerTrial) * 100) >= 0 ? '+' : ''}{((simulationResults.medianProfit / simulationResults.handsPerTrial) * 100).toFixed(4)}
                  </div>
                  <div className="text-[11px] text-zinc-600 mt-1">typical outcome</div>
                </motion.div>

                <motion.div 
                  className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
                  variants={scaleIn}
                >
                  <div className="text-[11px] text-zinc-500 mb-2 uppercase tracking-wide">Top 20% Avg BB/100</div>
                  <div className="text-2xl font-bold text-emerald-400">
                    {simulationResults.top20BBper100 >= 0 ? '+' : ''}{simulationResults.top20BBper100.toFixed(4)}
                  </div>
                  <div className="text-[11px] text-zinc-600 mt-1">luckiest {Math.max(1, Math.floor(simulationResults.totalTrials * 0.2))} trials</div>
                </motion.div>

                <motion.div 
                  className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
                  variants={scaleIn}
                >
                  <div className="text-[11px] text-zinc-500 mb-2 uppercase tracking-wide">Bottom 20% Avg BB/100</div>
                  <div className="text-2xl font-bold text-red-400">
                    {simulationResults.bottom20BBper100 >= 0 ? '+' : ''}{simulationResults.bottom20BBper100.toFixed(4)}
                  </div>
                  <div className="text-[11px] text-zinc-600 mt-1">unluckiest {Math.max(1, Math.floor(simulationResults.totalTrials * 0.2))} trials</div>
                </motion.div>
              </div>

              {/* Range Statistics */}
              <div className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5">
                <h4 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider">
                  Outcome Range
                </h4>
                <div className="flex justify-between items-center flex-wrap gap-5">
                  <div className="text-center">
                    <div className="text-[11px] text-zinc-500 mb-1">Worst Trial</div>
                    <div className="text-lg font-bold text-red-400">
                      {formatSimValue(simulationResults.minProfit, true)}
                    </div>
                  </div>
                  <div className="flex-1 min-w-[200px] px-5">
                    <div className="relative h-2 bg-zinc-800 rounded-full">
                      <div 
                        className="absolute inset-0 bg-gradient-to-r from-red-500 via-yellow-500 to-emerald-500 rounded-full opacity-60"
                      />
                      <motion.div 
                        className="absolute top-[-4px] w-1 h-4 bg-[#a88b46] rounded"
                        style={{
                          left: `${((simulationResults.averageProfit - simulationResults.minProfit) / (simulationResults.maxProfit - simulationResults.minProfit)) * 100}%`,
                          transform: 'translateX(-50%)'
                        }}
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        transition={{ delay: 0.5 }}
                      />
                    </div>
                  </div>
                  <div className="text-center">
                    <div className="text-[11px] text-zinc-500 mb-1">Best Trial</div>
                    <div className="text-lg font-bold text-emerald-400">
                      {formatSimValue(simulationResults.maxProfit, true)}
                    </div>
                  </div>
                </div>
                <div className="mt-4 text-center text-xs text-zinc-500">
                  Range: {formatSimValue(simulationResults.maxProfit - simulationResults.minProfit)} spread between best and worst outcomes
                </div>
              </div>

              {/* Variance Summary */}
              {(() => {
                const sortedTrials = [...simulationResults.trials].sort((a, b) => a.netProfit - b.netProfit);
                const twentyPercent = Math.max(1, Math.floor(sortedTrials.length * 0.2));
                
                const bottom20 = sortedTrials.slice(0, twentyPercent);
                const bottom20Avg = {
                  netProfit: bottom20.reduce((sum, t) => sum + t.netProfit, 0) / bottom20.length,
                  bbjsHit: (bottom20.reduce((sum, t) => sum + t.bbjsHit, 0) / bottom20.length).toFixed(1),
                  jackpotWins: (bottom20.reduce((sum, t) => sum + t.jackpotWins, 0) / bottom20.length).toFixed(2),
                  opponentWins: (bottom20.reduce((sum, t) => sum + t.opponentWins, 0) / bottom20.length).toFixed(2),
                  tableShares: (bottom20.reduce((sum, t) => sum + t.tableShares, 0) / bottom20.length).toFixed(1),
                  feesPaid: bottom20.reduce((sum, t) => sum + t.feesPaid, 0) / bottom20.length,
                };
                
                const top20 = sortedTrials.slice(-twentyPercent);
                const top20Avg = {
                  netProfit: top20.reduce((sum, t) => sum + t.netProfit, 0) / top20.length,
                  bbjsHit: (top20.reduce((sum, t) => sum + t.bbjsHit, 0) / top20.length).toFixed(1),
                  jackpotWins: (top20.reduce((sum, t) => sum + t.jackpotWins, 0) / top20.length).toFixed(2),
                  opponentWins: (top20.reduce((sum, t) => sum + t.opponentWins, 0) / top20.length).toFixed(2),
                  tableShares: (top20.reduce((sum, t) => sum + t.tableShares, 0) / top20.length).toFixed(1),
                  feesPaid: top20.reduce((sum, t) => sum + t.feesPaid, 0) / top20.length,
                };
                
                const handsLabel = simulationResults.handsPerTrial >= 1000000 
                  ? `${(simulationResults.handsPerTrial / 1000000)}M` 
                  : `${(simulationResults.handsPerTrial / 1000)}K`;
                
                return (
                  <motion.div 
                    className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-6 mt-6"
                    variants={fadeIn}
                  >
                    <h4 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider">
                      What Makes the Difference? (Top 20% vs Bottom 20%)
                    </h4>
                    
                    {/* Comparison Table */}
                    <div className="overflow-x-auto">
                      <div className="min-w-[400px]">
                        {/* Header */}
                        <div className="grid grid-cols-3 bg-zinc-800/50 rounded-t-xl py-3 px-5 border-b border-zinc-700">
                          <div className="text-xs text-zinc-500 font-medium">Metric</div>
                          <div className="text-xs text-red-400 font-medium text-center">Bottom 20%</div>
                          <div className="text-xs text-emerald-400 font-medium text-center">Top 20%</div>
                        </div>
                        
                        {/* Rows */}
                        {[
                          { label: 'Net Profit', bottom: formatSimValue(bottom20Avg.netProfit, true), top: formatSimValue(top20Avg.netProfit, true), highlight: true },
                          { label: 'BBJs Witnessed', bottom: bottom20Avg.bbjsHit, top: top20Avg.bbjsHit },
                          { label: 'Jackpot Wins', bottom: bottom20Avg.jackpotWins, top: top20Avg.jackpotWins },
                          { label: 'Opponent Wins', bottom: bottom20Avg.opponentWins, top: top20Avg.opponentWins },
                          { label: 'Table Shares', bottom: bottom20Avg.tableShares, top: top20Avg.tableShares },
                          { label: 'Fees Paid', bottom: formatSimValue(bottom20Avg.feesPaid), top: formatSimValue(top20Avg.feesPaid) },
                        ].map((row, idx) => (
                          <div 
                            key={row.label}
                            className={`grid grid-cols-3 py-3 px-5 ${
                              row.highlight ? 'bg-[#a88b46]/10 border-b border-[#a88b46]/20' : 
                              idx < 5 ? 'border-b border-zinc-800' : ''
                            }`}
                          >
                            <div className="text-sm text-zinc-400">{row.label}</div>
                            <div className={`text-base text-center font-semibold ${row.highlight ? 'text-red-400' : 'text-white'}`}>
                              {row.bottom}
                            </div>
                            <div className={`text-base text-center font-semibold ${row.highlight ? 'text-emerald-400' : 'text-white'}`}>
                              {row.top}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    {/* Summary */}
                    <div className="flex items-center gap-4 p-4 bg-zinc-800/30 rounded-xl mt-5 text-sm text-zinc-300">
                      <div className="flex-shrink-0 w-12 h-12 rounded-full bg-[#a88b46]/20 flex items-center justify-center text-xl">
                        📊
                      </div>
                      <div>
                        <strong className="text-[#a88b46]">The Gap: </strong>
                        <strong className="text-white">{formatSimValue(top20Avg.netProfit - bottom20Avg.netProfit)}</strong> difference.
                        {simulationResults.profitableTrials < simulationResults.totalTrials && simulationResults.profitableTrials > 0 && (
                          <span>
                            {' '}Only <strong className={simulationResults.profitableTrials / simulationResults.totalTrials >= 0.5 ? 'text-emerald-400' : 'text-red-400'}>
                              {((simulationResults.profitableTrials / simulationResults.totalTrials) * 100).toFixed(0)}%
                            </strong> of simulations were profitable.
                          </span>
                        )}
                        {simulationResults.profitableTrials === 0 && (
                          <span className="text-red-400">
                            {' '}<strong>0%</strong> of simulations were profitable.
                          </span>
                        )}
                        {simulationResults.profitableTrials === simulationResults.totalTrials && (
                          <span className="text-emerald-400">
                            {' '}<strong>100%</strong> of simulations were profitable!
                          </span>
                        )}
                      </div>
                    </div>
                  </motion.div>
                );
              })()}
            </motion.div>
          )}

          {/* Empty State */}
          {!simulationResults && !isCalculating && (
            <div className="text-center py-10 px-5 bg-zinc-900/30 rounded-2xl border border-dashed border-zinc-700">
              <LineChart size={40} className="text-zinc-700 mx-auto mb-3" />
              <div className="text-sm text-zinc-500 mb-2">
                No simulation run yet
              </div>
              <div className="text-xs text-zinc-600">
                Configure your settings above and click "Run Simulations" to see how variance affects your bankroll across {numTrials} simulated poker sessions of {simulationHands >= 1000000 ? `${(simulationHands / 1000000)}M` : `${(simulationHands / 1000)}K`} hands each
              </div>
            </div>
          )}
        </motion.div>

        {/* Main Dashboard Card */}
        <motion.div 
          className="rounded-3xl p-6 md:p-10 mb-8 bg-white/[0.03] backdrop-blur-xl border border-white/10"
          variants={fadeInUp}
          initial="hidden"
          animate="visible"
          transition={{ delay: 0.2 }}
        >
          <div className="flex items-center justify-center gap-3 mb-2">
            <Target size={28} className="text-[#a88b46]" />
            <h1 className="text-2xl md:text-3xl font-bold text-white">BBJ Pool Size & Expected Value</h1>
          </div>
          <p className="text-center text-zinc-500 text-sm mb-8 max-w-3xl mx-auto">
            Adjust the pool size and your stakes to see how they affect your expected value. These calculations are based on historical data and should be used as indicative estimates only—actual results may vary due to the inherent randomness of poker and changing jackpot conditions.
          </p>

          {/* Pool Size & Stake Input */}
          <motion.div 
            className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-6 mb-8"
            variants={scaleIn}
          >
            <h3 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider flex items-center gap-2">
              <DollarSign size={16} /> Pool Size & Your Stakes
            </h3>
            <div className="flex gap-5 flex-wrap mb-4">
              <div className="flex-1 min-w-[200px]">
                <label className="text-[11px] text-zinc-500 block mb-1.5">
                  Total Jackpot Pool (USD)
                </label>
                <input
                  type="number"
                  className="w-full bg-zinc-800/50 border border-zinc-700 rounded-xl px-4 py-3 text-white text-lg font-semibold focus:border-[#a88b46] focus:ring-1 focus:ring-[#a88b46]/30 outline-none transition-all"
                  placeholder="e.g., 2172588"
                  value={poolSize}
                  onChange={(e) => setPoolSize(parseFloat(e.target.value) || 0)}
                />
              </div>
              <div className="flex-1 min-w-[300px]">
                <label className="text-[11px] text-zinc-500 block mb-1.5">
                  Your Stakes
                </label>
                <div className="grid grid-cols-5 gap-1">
                  {STAKE_OPTIONS.map(stake => (
                    <button
                      key={stake.value}
                      onClick={() => setSelectedStake(stake.value)}
                      className={`py-2 px-1 rounded-lg text-[10px] font-semibold transition-all duration-200 whitespace-nowrap ${
                        selectedStake === stake.value 
                          ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                          : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 hover:text-white border border-zinc-700'
                      }`}
                    >
                      {stake.value}
                    </button>
                  ))}
                </div>
              </div>
            </div>
            <div className="flex gap-2 flex-wrap mb-4">
              {[1800000, 2000000, 2276000, 2400000, 2600000].map(preset => (
                <button
                  key={preset}
                  onClick={() => setPoolSize(preset)}
                  className={`px-4 py-2 rounded-xl text-xs font-medium transition-all duration-200 ${
                    poolSize === preset 
                      ? 'bg-gradient-to-r from-[#a88b46] to-[#a88b46] text-zinc-950' 
                      : 'bg-zinc-800/50 text-zinc-400 hover:bg-zinc-800 hover:text-white border border-zinc-700'
                  }`}
                >
                  {formatCurrency(preset)}
                </button>
              ))}
            </div>
            <div className="flex justify-between items-center flex-wrap gap-3">
              <span className="text-xs text-zinc-500">
                Your stake fund: <span className="text-[#a88b46] font-semibold">{formatCurrency(currentEV.stakePoolSize)}</span>
                <span className="text-zinc-600 ml-2">
                  ({(STAKE_OPTIONS.find(s => s.value === selectedStake)?.poolPercent || 0).toFixed(2)}% of total)
                </span>
              </span>
              <span className={`text-xs font-semibold px-3 py-1.5 rounded-lg ${
                currentEV.isProfitable 
                  ? 'bg-emerald-500/20 text-emerald-400' 
                  : 'bg-red-500/20 text-red-400'
              }`}>
                {currentEV.isProfitable ? '✓ +EV at this pool' : `✗ -EV (need ${formatCurrency(Math.abs(currentEV.poolNeeded))} more)`}
              </span>
            </div>
          </motion.div>

          {/* EV Overview Grid */}
          <motion.div 
            className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8"
            variants={staggerContainer}
            initial="hidden"
            animate="visible"
          >
            {/* Main EV Gauge */}
            <motion.div 
              className={`rounded-2xl p-5 border ${
                currentEV.isProfitable 
                  ? 'bg-emerald-500/10 border-emerald-500/30' 
                  : 'bg-red-500/10 border-red-500/30'
              }`}
              variants={scaleIn}
            >
              <h3 className={`mb-2 text-sm font-semibold uppercase tracking-wider flex items-center gap-2 ${
                currentEV.isProfitable ? 'text-emerald-400' : 'text-red-400'
              }`}>
                <Activity size={14} /> Your Expected Value
              </h3>
              <EVGauge key={`ev-${currentEV.netBBper100.toFixed(4)}`} value={currentEV.netBBper100} min={-1.5} max={1.5} />
              <div className="text-center mt-2">
                <span className="text-[11px] text-zinc-500 bg-zinc-900/50 px-3 py-1 rounded-lg">
                  {currentEV.isProfitable ? 'Playing is +EV at this pool size' : 'You\'re paying to chase the dream'}
                </span>
              </div>
            </motion.div>

            {/* Pool Progress */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider flex items-center gap-2">
                <TrendingUp size={14} /> Pool vs Breakeven
              </h3>
              <div className="mb-4">
                <div className="flex justify-between mb-2">
                  <span className="text-2xl font-bold text-white">
                    {currentEV.percentToBreakeven.toFixed(1)}%
                  </span>
                  <span className={`text-xs self-end ${currentEV.isProfitable ? 'text-emerald-400' : 'text-zinc-500'}`}>
                    {currentEV.isProfitable ? 'Above breakeven!' : `${formatCurrency(currentEV.poolNeeded)} needed`}
                  </span>
                </div>
                <ProgressBar 
                  key={`progress-${poolSize}`}
                  value={poolSize} 
                  max={BBJ_CONSTANTS.breakevenPool_usd * 1.5} 
                  color={currentEV.isProfitable ? '#34d399' : '#a88b46'}
                  showLabel={false}
                />
                <div className="flex justify-between mt-1.5 text-[10px] text-zinc-600">
                  <span>$0</span>
                  <span className="text-[#a88b46]">Breakeven</span>
                  <span>{formatCurrency(BBJ_CONSTANTS.breakevenPool_usd * 1.5)}</span>
                </div>
              </div>
            </motion.div>

            {/* Payout Breakdown */}
            <motion.div 
              className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-5"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] mb-4 text-sm font-semibold uppercase tracking-wider flex items-center gap-2">
                <Zap size={14} /> When BBJ Hits at Your Stake
              </h3>
              <div className="text-xs text-zinc-500 mb-3">
                Total distributed: <span className="text-[#a88b46] font-semibold">{formatCurrency(currentEV.totalPayoutAtStake)}</span>
              </div>
              <div className="flex flex-col gap-2">
                <div className="flex justify-between items-center bg-emerald-500/10 rounded-xl p-3">
                  <div>
                    <div className="text-[11px] text-zinc-400">Bad Beat Winner</div>
                    <div className="text-[10px] text-zinc-600">(Loser with quads+) • 10%</div>
                  </div>
                  <div className="text-base font-bold text-emerald-400">{formatCurrency(currentEV.jackpotWinnerPayout)}</div>
                </div>
                <div className="flex justify-between items-center bg-blue-500/10 rounded-xl p-3">
                  <div>
                    <div className="text-[11px] text-zinc-400">Bad Beat Opponent</div>
                    <div className="text-[10px] text-zinc-600">(Winner of hand) • 3%</div>
                  </div>
                  <div className="text-base font-bold text-blue-400">{formatCurrency(currentEV.opponentPayout)}</div>
                </div>
                <div className="flex justify-between items-center bg-purple-500/10 rounded-xl p-3">
                  <div>
                    <div className="text-[11px] text-zinc-400">Table Share</div>
                    <div className="text-[10px] text-zinc-600">(Each other player) • 0.8%</div>
                  </div>
                  <div className="text-base font-bold text-purple-400">{formatCurrency(currentEV.tableSharePayout)}</div>
                </div>
              </div>
            </motion.div>
          </motion.div>

          {/* EV by Pool Size Table */}
          <motion.div 
            className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-6"
            variants={fadeIn}
          >
            <h3 className="text-[#a88b46] mb-5 text-sm font-semibold uppercase tracking-wider flex items-center gap-2">
              <TrendingUp size={16} /> EV at Different Pool Sizes ({STAKE_OPTIONS.find(s => s.value === selectedStake)?.label})
            </h3>
            
            <div className="overflow-x-auto">
              <table className="w-full min-w-[600px]">
                <thead>
                  <tr className="border-b border-zinc-700">
                    <th className="py-3 px-2 text-left text-[11px] text-zinc-500 font-semibold">Total Pool</th>
                    <th className="py-3 px-2 text-right text-[11px] text-zinc-500 font-semibold">Your Stake Fund</th>
                    <th className="py-3 px-2 text-right text-[11px] text-zinc-500 font-semibold">Jackpot Win</th>
                    <th className="py-3 px-2 text-right text-[11px] text-zinc-500 font-semibold">Net BB/100</th>
                    <th className="py-3 px-2 text-center text-[11px] text-zinc-500 font-semibold">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {evTableData.map((row, index) => (
                    <tr 
                      key={row.pool}
                      className={`border-b border-zinc-800/50 ${
                        row.pool === poolSize ? 'bg-[#a88b46]/10' : ''
                      }`}
                    >
                      <td className="py-3 px-2 text-sm text-white font-medium">
                        {formatCurrency(row.pool)}
                      </td>
                      <td className="py-3 px-2 text-sm text-zinc-400 text-right">
                        {formatCurrency(row.stakePoolSize)}
                      </td>
                      <td className="py-3 px-2 text-sm text-emerald-400 text-right font-semibold">
                        {formatCurrency(row.jackpotWinnerPayout)}
                      </td>
                      <td className={`py-3 px-2 text-sm text-right font-bold ${getEVColor(row.netBBper100)}`}>
                        {row.netBBper100 >= 0 ? '+' : ''}{row.netBBper100.toFixed(3)}
                      </td>
                      <td className="py-3 px-2 text-center">
                        <span className={`text-[11px] font-semibold px-2 py-1 rounded ${
                          row.isProfitable 
                            ? 'bg-emerald-500/20 text-emerald-400' 
                            : 'bg-red-500/20 text-red-400'
                        }`}>
                          {row.isProfitable ? '+EV' : '-EV'}
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <div className="mt-4 text-xs text-zinc-500 text-center">
              Fee cost: <span className="text-red-400">-{BBJ_CONSTANTS.bbPer100Fees.toFixed(4)} bb/100</span> • 
              Breakeven requires expected return to exceed fee cost
            </div>
          </motion.div>
        </motion.div>

        {/* Insights Section */}
        <motion.div 
          className="rounded-3xl p-6 md:p-10 mb-8 bg-white/[0.03] backdrop-blur-xl border border-white/10"
          variants={fadeInUp}
          initial="hidden"
          animate="visible"
          transition={{ delay: 0.25 }}
        >
          <div className="flex items-center justify-center gap-3 mb-7">
            <AlertTriangle size={24} className="text-[#a88b46]" />
            <h2 className="text-xl font-semibold text-white">Reality Check</h2>
          </div>

          <motion.div 
            className="grid grid-cols-1 md:grid-cols-3 gap-5"
            variants={staggerContainer}
            initial="hidden"
            animate="visible"
          >
            {/* Insight 1 */}
            <motion.div 
              className="bg-red-500/10 border border-red-500/20 rounded-2xl p-6"
              variants={scaleIn}
            >
              <h3 className="text-red-400 text-sm font-semibold mb-3">
                The Odds Are Astronomical
              </h3>
              <p className="text-zinc-400 text-sm leading-relaxed">
                To WIN the main jackpot (lose with AAATT or better), you need to play <strong className="text-white">~{PROBABILITY_DATA.handsToWinJackpot.toLocaleString()} hands</strong>. 
                At 500 hands/hour, that's <strong className="text-white">{Math.round(PROBABILITY_DATA.handsToWinJackpot / 500).toLocaleString()} hours</strong> , 
                or about <strong className="text-white">{Math.round(PROBABILITY_DATA.handsToWinJackpot / 500 / 8)} days</strong> of 8-hour sessions.
              </p>
            </motion.div>

            {/* Insight 2 */}
            <motion.div 
              className="bg-[#a88b46]/10 border border-[#a88b46]/20 rounded-2xl p-6"
              variants={scaleIn}
            >
              <h3 className="text-[#a88b46] text-sm font-semibold mb-3">
                Most Players Never Win It
              </h3>
              <p className="text-zinc-400 text-sm leading-relaxed">
                To <em>win</em> the main jackpot, you need <strong className="text-white">{PROBABILITY_DATA.handsToWinJackpot.toLocaleString()} hands</strong>. 
                A recreational player grinding 5 hours/week at 80 hands/hour would need <strong className="text-white">~{Math.round(PROBABILITY_DATA.handsToWinJackpot / (5 * 80 * 52))} years</strong> of play 
                to expect one jackpot win. That's longer than most poker careers.
              </p>
            </motion.div>

            {/* Insight 3 */}
            <motion.div 
              className="bg-emerald-500/10 border border-emerald-500/20 rounded-2xl p-6"
              variants={scaleIn}
            >
              <h3 className="text-emerald-400 text-sm font-semibold mb-3">
                Table Share is Your Best Bet
              </h3>
              <p className="text-zinc-400 text-sm leading-relaxed">
                You'll get a table share once every <strong className="text-white">~{PROBABILITY_DATA.handsToGetTableShare.toLocaleString()} hands</strong> , 
                about <strong className="text-white">4x more often</strong> than winning the main prize. 
                It's small ({formatCurrency(currentEV.tableSharePayout)} at your stake), but it's something!
              </p>
            </motion.div>
          </motion.div>

          <div className="mt-6 p-5 bg-zinc-900/50 rounded-2xl border border-zinc-800 text-center">
            <p className="text-zinc-400 text-sm leading-relaxed">
              <strong className="text-[#a88b46]">Bottom Line:</strong> At current pool levels, you're paying <strong className="text-red-400">{BBJ_CONSTANTS.bbPer100Fees.toFixed(2)} bb/100</strong> in fees. 
              Your expected return is <strong className={currentEV.netBBper100 >= 0 ? 'text-emerald-400' : 'text-red-400'}>{currentEV.netBBper100 >= 0 ? '+' : ''}{currentEV.netBBper100.toFixed(3)} bb/100</strong>. 
              {currentEV.isProfitable 
                ? " The pool is high enough to make BBJ tables mathematically +EV!"
                : ` The pool needs to reach about ${formatCurrency(poolSize + currentEV.poolNeeded)} before playing BBJ tables becomes +EV.`
              }
            </p>
          </div>
        </motion.div>

        {/* Footer */}
        <motion.div 
          className="text-center py-8 text-zinc-600 text-xs"
          variants={fadeIn}
          initial="hidden"
          animate="visible"
          transition={{ delay: 0.3 }}
        >
          <p>
            Data based on 178.6M verified hands from GGPoker (NL100+) • 1,952 BBJ triggers analyzed
          </p>
          <p className="mt-2">
            Built with 🌮 by Freenachos
          </p>
        </motion.div>
      </div>
    </div>
  );
};

export default BBJDashboard;
